'use strict';

var Promise = require('bluebird');
var _ = require('lodash');
var util = require('util');

var dseDriver = void 0;
try {
  // eslint-disable-next-line import/no-extraneous-dependencies, import/no-unresolved
  dseDriver = require('dse-driver');
} catch (e) {
  dseDriver = null;
}

var cql = Promise.promisifyAll(dseDriver || require('cassandra-driver'));

var buildError = require('./apollo_error.js');
var schemer = require('../validators/schema');
var normalizer = require('../utils/normalizer');
var parser = require('../utils/parser');

var TableBuilder = require('../builders/table');
var ElassandraBuilder = require('../builders/elassandra');
var JanusGraphBuilder = require('../builders/janusgraph');
var Driver = require('../helpers/driver');

var BaseModel = function f(instanceValues) {
  instanceValues = instanceValues || {};
  var fieldValues = {};
  var fields = this.constructor._properties.schema.fields;
  var methods = this.constructor._properties.schema.methods || {};
  var model = this;

  var defaultSetter = function f1(propName, newValue) {
    if (this[propName] !== newValue) {
      model._modified[propName] = true;
    }
    this[propName] = newValue;
  };

  var defaultGetter = function f1(propName) {
    return this[propName];
  };

  this._modified = {};
  this._validators = {};

  for (var fieldsKeys = Object.keys(fields), i = 0, len = fieldsKeys.length; i < len; i++) {
    var propertyName = fieldsKeys[i];
    var field = fields[fieldsKeys[i]];

    try {
      this._validators[propertyName] = schemer.get_validators(this.constructor._properties.schema, propertyName);
    } catch (e) {
      throw buildError('model.validator.invalidschema', e.message);
    }

    var setter = defaultSetter.bind(fieldValues, propertyName);
    var getter = defaultGetter.bind(fieldValues, propertyName);

    if (field.virtual && typeof field.virtual.set === 'function') {
      setter = field.virtual.set.bind(fieldValues);
    }

    if (field.virtual && typeof field.virtual.get === 'function') {
      getter = field.virtual.get.bind(fieldValues);
    }

    var descriptor = {
      enumerable: true,
      set: setter,
      get: getter
    };

    Object.defineProperty(this, propertyName, descriptor);
    if (!field.virtual) {
      this[propertyName] = instanceValues[propertyName];
    }
  }

  for (var methodNames = Object.keys(methods), _i = 0, _len = methodNames.length; _i < _len; _i++) {
    var methodName = methodNames[_i];
    var method = methods[methodName];
    this[methodName] = method;
  }
};

BaseModel._properties = {
  name: null,
  schema: null
};

BaseModel._set_properties = function f(properties) {
  var schema = properties.schema;
  var tableName = schema.table_name || properties.name;

  if (!schemer.validate_table_name(tableName)) {
    throw buildError('model.tablecreation.invalidname', tableName);
  }

  var qualifiedTableName = util.format('"%s"."%s"', properties.keyspace, tableName);

  this._properties = properties;
  this._properties.table_name = tableName;
  this._properties.qualified_table_name = qualifiedTableName;
  this._driver = new Driver(this._properties);
};

BaseModel._sync_model_definition = function f(callback) {
  var properties = this._properties;
  var tableName = properties.table_name;
  var modelSchema = properties.schema;
  var migration = properties.migration;

  var tableBuilder = new TableBuilder(this._driver, this._properties);

  // backwards compatible change, dropTableOnSchemaChange will work like migration: 'drop'
  if (!migration) {
    if (properties.dropTableOnSchemaChange) migration = 'drop';else migration = 'safe';
  }
  // always safe migrate if NODE_ENV==='production'
  if (process.env.NODE_ENV === 'production') migration = 'safe';

  // check for existence of table on DB and if it matches this model's schema
  tableBuilder.get_table_schema(function (err, dbSchema) {
    if (err) {
      callback(err);
      return;
    }

    var afterDBCreate = function afterDBCreate(err1) {
      if (err1) {
        callback(err1);
        return;
      }

      var indexingTasks = [];

      // cassandra index create if defined
      if (_.isArray(modelSchema.indexes)) {
        tableBuilder.createIndexesAsync = Promise.promisify(tableBuilder.create_indexes);
        indexingTasks.push(tableBuilder.createIndexesAsync(modelSchema.indexes));
      }
      // cassandra custom index create if defined
      if (_.isArray(modelSchema.custom_indexes)) {
        tableBuilder.createCustomIndexesAsync = Promise.promisify(tableBuilder.create_custom_indexes);
        indexingTasks.push(tableBuilder.createCustomIndexesAsync(modelSchema.custom_indexes));
      }
      if (modelSchema.custom_index) {
        tableBuilder.createCustomIndexAsync = Promise.promisify(tableBuilder.create_custom_indexes);
        indexingTasks.push(tableBuilder.createCustomIndexAsync([modelSchema.custom_index]));
      }
      // materialized view create if defined
      if (modelSchema.materialized_views) {
        tableBuilder.createViewsAsync = Promise.promisify(tableBuilder.create_mviews);
        indexingTasks.push(tableBuilder.createViewsAsync(modelSchema.materialized_views));
      }

      Promise.all(indexingTasks).then(function () {
        // db schema was updated, so callback with true
        callback(null, true);
      }).catch(function (err2) {
        callback(err2);
      });
    };

    if (!dbSchema) {
      if (properties.createTable === false) {
        callback(buildError('model.tablecreation.schemanotfound', tableName));
        return;
      }
      // if not existing, it's created
      tableBuilder.create_table(modelSchema, afterDBCreate);
      return;
    }

    var normalizedModelSchema = void 0;
    var normalizedDBSchema = void 0;

    try {
      normalizedModelSchema = normalizer.normalize_model_schema(modelSchema);
      normalizedDBSchema = normalizer.normalize_model_schema(dbSchema);
    } catch (e) {
      throw buildError('model.validator.invalidschema', e.message);
    }

    if (_.isEqual(normalizedModelSchema, normalizedDBSchema)) {
      // no change in db was made, so callback with false
      callback(null, false);
      return;
    }

    if (migration === 'alter') {
      // check if table can be altered to match schema
      if (_.isEqual(normalizedModelSchema.key, normalizedDBSchema.key) && _.isEqual(normalizedModelSchema.clustering_order, normalizedDBSchema.clustering_order)) {
        tableBuilder.init_alter_operations(modelSchema, dbSchema, normalizedModelSchema, normalizedDBSchema, function (err1) {
          if (err1 && err1.message === 'alter_impossible') {
            tableBuilder.drop_recreate_table(modelSchema, normalizedDBSchema.materialized_views, afterDBCreate);
            return;
          }
          callback(err1);
        });
      } else {
        tableBuilder.drop_recreate_table(modelSchema, normalizedDBSchema.materialized_views, afterDBCreate);
      }
    } else if (migration === 'drop') {
      tableBuilder.drop_recreate_table(modelSchema, normalizedDBSchema.materialized_views, afterDBCreate);
    } else {
      callback(buildError('model.tablecreation.schemamismatch', tableName, 'migration suspended, please apply the change manually'));
    }
  });
};

BaseModel._sync_es_index = function f(callback) {
  var properties = this._properties;

  if (properties.esclient && properties.schema.es_index_mapping) {
    var keyspaceName = properties.keyspace;
    var mappingName = properties.table_name;
    var indexName = `${keyspaceName}_${mappingName}`;

    var elassandraBuilder = new ElassandraBuilder(properties.esclient);
    elassandraBuilder.assert_index(keyspaceName, indexName, function (err) {
      if (err) {
        callback(err);
        return;
      }
      elassandraBuilder.put_mapping(indexName, mappingName, properties.schema.es_index_mapping, callback);
    });
    return;
  }
  callback();
};

BaseModel._sync_graph = function f(callback) {
  var properties = this._properties;

  if (properties.gremlin_client && properties.schema.graph_mapping) {
    var graphName = `${properties.keyspace}_graph`;
    var mappingName = properties.table_name;

    var graphBuilder = new JanusGraphBuilder(properties.gremlin_client);
    graphBuilder.assert_graph(graphName, function (err) {
      if (err) {
        callback(err);
        return;
      }
      graphBuilder.put_mapping(graphName, mappingName, properties.schema.graph_mapping, callback);
    });
    return;
  }
  callback();
};

BaseModel._execute_table_query = function f(query, params, options, callback) {
  if (arguments.length === 3) {
    callback = options;
    options = {};
  }

  var defaults = {
    prepare: true
  };

  options = _.defaultsDeep(options, defaults);

  var doExecuteQuery = function f1(doquery, docallback) {
    this.execute_query(doquery, params, options, docallback);
  }.bind(this, query);

  if (this.is_table_ready()) {
    doExecuteQuery(callback);
  } else {
    this.init(function (err) {
      if (err) {
        callback(err);
        return;
      }
      doExecuteQuery(callback);
    });
  }
};

BaseModel.get_find_query = function f(queryObject, options) {
  var orderbyClause = parser.get_orderby_clause(queryObject);
  var limitClause = parser.get_limit_clause(queryObject);
  var whereClause = parser.get_where_clause(this._properties.schema, queryObject);
  var selectClause = parser.get_select_clause(options);

  var query = util.format('SELECT %s %s FROM "%s" %s %s %s', options.distinct ? 'DISTINCT' : '', selectClause, options.materialized_view ? options.materialized_view : this._properties.table_name, whereClause.query, orderbyClause, limitClause);

  if (options.allow_filtering) query += ' ALLOW FILTERING;';else query += ';';

  return { query, params: whereClause.params };
};

BaseModel.get_table_name = function f() {
  return this._properties.table_name;
};

BaseModel.get_keyspace_name = function f() {
  return this._properties.keyspace;
};

BaseModel.is_table_ready = function f() {
  return this._ready === true;
};

BaseModel.init = function f(options, callback) {
  if (!callback) {
    callback = options;
    options = undefined;
  }

  this._ready = true;
  callback();
};

BaseModel.syncDB = function f(callback) {
  var _this = this;

  this._sync_model_definition(function (err, result) {
    if (err) {
      callback(err);
      return;
    }

    _this._sync_es_index(function (err1) {
      if (err1) {
        callback(err1);
        return;
      }

      _this._sync_graph(function (err2) {
        if (err2) {
          callback(err2);
          return;
        }

        _this._ready = true;
        callback(null, result);
      });
    });
  });
};

BaseModel.get_cql_client = function f(callback) {
  var _this2 = this;

  this._driver.ensure_init(function (err) {
    if (err) {
      callback(err);
      return;
    }
    callback(null, _this2._properties.cql);
  });
};

BaseModel.get_es_client = function f() {
  if (!this._properties.esclient) {
    throw new Error('To use elassandra features, set `manageESIndex` to true in ormOptions');
  }
  return this._properties.esclient;
};

BaseModel.get_gremlin_client = function f() {
  if (!this._properties.gremlin_client) {
    throw new Error('To use janus graph features, set `manageGraphs` to true in ormOptions');
  }
  return this._properties.gremlin_client;
};

BaseModel.execute_query = function f() {
  var _driver;

  (_driver = this._driver).execute_query.apply(_driver, arguments);
};

BaseModel.execute_batch = function f() {
  var _driver2;

  (_driver2 = this._driver).execute_batch.apply(_driver2, arguments);
};

BaseModel.execute_eachRow = function f() {
  var _driver3;

  (_driver3 = this._driver).execute_eachRow.apply(_driver3, arguments);
};

BaseModel._execute_table_eachRow = function f(query, params, options, onReadable, callback) {
  var _this3 = this;

  if (this.is_table_ready()) {
    this.execute_eachRow(query, params, options, onReadable, callback);
  } else {
    this.init(function (err) {
      if (err) {
        callback(err);
        return;
      }
      _this3.execute_eachRow(query, params, options, onReadable, callback);
    });
  }
};

BaseModel.eachRow = function f(queryObject, options, onReadable, callback) {
  var _this4 = this;

  if (arguments.length === 3) {
    var cb = onReadable;
    onReadable = options;
    callback = cb;
    options = {};
  }
  if (typeof onReadable !== 'function') {
    throw buildError('model.find.eachrowerror', 'no valid onReadable function was provided');
  }
  if (typeof callback !== 'function') {
    throw buildError('model.find.cberror');
  }

  var defaults = {
    raw: false,
    prepare: true
  };

  options = _.defaultsDeep(options, defaults);

  options.return_query = true;
  var selectQuery = this.find(queryObject, options);

  var queryOptions = normalizer.normalize_query_option(options);

  this._execute_table_eachRow(selectQuery.query, selectQuery.params, queryOptions, function (n, row) {
    if (!options.raw) {
      var ModelConstructor = _this4._properties.get_constructor();
      row = new ModelConstructor(row);
      row._modified = {};
    }
    onReadable(n, row);
  }, function (err, result) {
    if (err) {
      callback(buildError('model.find.dberror', err));
      return;
    }
    callback(err, result);
  });
};

BaseModel.execute_stream = function f() {
  var _driver4;

  (_driver4 = this._driver).execute_stream.apply(_driver4, arguments);
};

BaseModel._execute_table_stream = function f(query, params, options, onReadable, callback) {
  var _this5 = this;

  if (this.is_table_ready()) {
    this.execute_stream(query, params, options, onReadable, callback);
  } else {
    this.init(function (err) {
      if (err) {
        callback(err);
        return;
      }
      _this5.execute_stream(query, params, options, onReadable, callback);
    });
  }
};

BaseModel.stream = function f(queryObject, options, onReadable, callback) {
  if (arguments.length === 3) {
    var cb = onReadable;
    onReadable = options;
    callback = cb;
    options = {};
  }

  if (typeof onReadable !== 'function') {
    throw buildError('model.find.streamerror', 'no valid onReadable function was provided');
  }
  if (typeof callback !== 'function') {
    throw buildError('model.find.cberror');
  }

  var defaults = {
    raw: false,
    prepare: true
  };

  options = _.defaultsDeep(options, defaults);

  options.return_query = true;
  var selectQuery = this.find(queryObject, options);

  var queryOptions = normalizer.normalize_query_option(options);

  var self = this;

  this._execute_table_stream(selectQuery.query, selectQuery.params, queryOptions, function f1() {
    var reader = this;
    reader.readRow = function () {
      var row = reader.read();
      if (!row) return row;
      if (!options.raw) {
        var ModelConstructor = self._properties.get_constructor();
        var o = new ModelConstructor(row);
        o._modified = {};
        return o;
      }
      return row;
    };
    onReadable(reader);
  }, function (err) {
    if (err) {
      callback(buildError('model.find.dberror', err));
      return;
    }
    callback();
  });
};

BaseModel._execute_gremlin_query = function f(script, bindings, callback) {
  var gremlinClient = this.get_gremlin_client();
  gremlinClient.execute(script, bindings, function (err, results) {
    if (err) {
      callback(err);
      return;
    }
    callback(null, results);
  });
};

BaseModel._execute_gremlin_script = function f(script, bindings, callback) {
  this._execute_gremlin_query(script, bindings, function (err, results) {
    if (err) {
      callback(err);
      return;
    }
    callback(null, results[0]);
  });
};

BaseModel.createVertex = function f(vertexProperties, callback) {
  var properties = this._properties;
  var __graphName = `${properties.keyspace}_graph`;
  var __vertexLabel = properties.table_name;
  var script = `
    graph = ConfiguredGraphFactory.open(__graphName);
    vertex = graph.addVertex(__vertexLabel);
  `;
  Object.keys(vertexProperties).forEach(function (property) {
    script += `vertex.property('${property}', ${property});`;
  });
  script += 'vertex';
  var bindings = _.defaults(vertexProperties, {
    __graphName,
    __vertexLabel
  });
  this._execute_gremlin_script(script, bindings, callback);
};

BaseModel.getVertex = function f(__vertexId, callback) {
  var properties = this._properties;
  var __graphName = `${properties.keyspace}_graph`;
  var script = `
    graph = ConfiguredGraphFactory.open(__graphName);
    g = graph.traversal();
    vertex = g.V(__vertexId);
  `;
  var bindings = {
    __graphName,
    __vertexId
  };
  this._execute_gremlin_script(script, bindings, callback);
};

BaseModel.updateVertex = function f(__vertexId, vertexProperties, callback) {
  var properties = this._properties;
  var __graphName = `${properties.keyspace}_graph`;
  var script = `
    graph = ConfiguredGraphFactory.open(__graphName);
    g = graph.traversal();
    vertex = g.V(__vertexId);
  `;
  Object.keys(vertexProperties).forEach(function (property) {
    script += `vertex.property('${property}', ${property});`;
  });
  script += 'vertex';
  var bindings = _.defaults(vertexProperties, {
    __graphName,
    __vertexId
  });
  this._execute_gremlin_script(script, bindings, callback);
};

BaseModel.deleteVertex = function f(__vertexId, callback) {
  var properties = this._properties;
  var __graphName = `${properties.keyspace}_graph`;
  var script = `
    graph = ConfiguredGraphFactory.open(__graphName);
    g = graph.traversal();
    vertex = g.V(__vertexId);
    vertex.drop();
  `;
  var bindings = {
    __graphName,
    __vertexId
  };
  this._execute_gremlin_script(script, bindings, callback);
};

BaseModel.createEdge = function f(__edgeLabel, __fromVertexId, __toVertexId, edgeProperties, callback) {
  if (arguments.length === 4 && typeof edgeProperties === 'function') {
    callback = edgeProperties;
    edgeProperties = {};
  }
  var properties = this._properties;
  var __graphName = `${properties.keyspace}_graph`;
  var script = `
    graph = ConfiguredGraphFactory.open(__graphName);
    g = graph.traversal();
    fromVertex = g.V(__fromVertexId).next();
    toVertex = g.V(__toVertexId).next();
    edge = fromVertex.addEdge(__edgeLabel, toVertex);
  `;
  Object.keys(edgeProperties).forEach(function (property) {
    script += `edge.property('${property}', ${property});`;
  });
  script += 'edge';
  var bindings = _.defaults(edgeProperties, {
    __graphName,
    __fromVertexId,
    __toVertexId,
    __edgeLabel
  });
  this._execute_gremlin_script(script, bindings, callback);
};

BaseModel.getEdge = function f(__edgeId, callback) {
  var properties = this._properties;
  var __graphName = `${properties.keyspace}_graph`;
  var script = `
    graph = ConfiguredGraphFactory.open(__graphName);
    g = graph.traversal();
    edge = g.E(__edgeId);
  `;
  var bindings = {
    __graphName,
    __edgeId
  };
  this._execute_gremlin_script(script, bindings, callback);
};

BaseModel.updateEdge = function f(__edgeId, edgeProperties, callback) {
  var properties = this._properties;
  var __graphName = `${properties.keyspace}_graph`;
  var script = `
    graph = ConfiguredGraphFactory.open(__graphName);
    g = graph.traversal();
    edge = g.E(__edgeId);
  `;
  Object.keys(edgeProperties).forEach(function (property) {
    script += `edge.property('${property}', ${property});`;
  });
  script += 'edge';
  var bindings = _.defaults(edgeProperties, {
    __graphName,
    __edgeId
  });
  this._execute_gremlin_script(script, bindings, callback);
};

BaseModel.deleteEdge = function f(__edgeId, callback) {
  var properties = this._properties;
  var __graphName = `${properties.keyspace}_graph`;
  var script = `
    graph = ConfiguredGraphFactory.open(__graphName);
    g = graph.traversal();
    edge = g.E(__edgeId);
    edge.drop();
  `;
  var bindings = {
    __graphName,
    __edgeId
  };
  this._execute_gremlin_script(script, bindings, callback);
};

BaseModel.graphQuery = function f(query, params, callback) {
  var properties = this._properties;
  var __graphName = `${properties.keyspace}_graph`;
  var __vertexLabel = properties.table_name;
  var script = `
    graph = ConfiguredGraphFactory.open(__graphName);
    g = graph.traversal();
    vertices = g.V().hasLabel(__vertexLabel);
  `;
  script += query;
  var bindings = _.defaults(params, {
    __graphName,
    __vertexLabel
  });
  this._execute_gremlin_query(script, bindings, callback);
};

BaseModel.search = function f(queryObject, callback) {
  var esClient = this.get_es_client();
  var indexName = `${this._properties.keyspace}_${this._properties.table_name}`;

  var query = _.defaults(queryObject, {
    index: indexName,
    type: this._properties.table_name
  });
  esClient.search(query, function (err, response) {
    if (err) {
      callback(err);
      return;
    }
    callback(null, response);
  });
};

BaseModel.find = function f(queryObject, options, callback) {
  var _this6 = this;

  if (arguments.length === 2 && typeof options === 'function') {
    callback = options;
    options = {};
  }
  if (typeof callback !== 'function' && !options.return_query) {
    throw buildError('model.find.cberror');
  }

  var defaults = {
    raw: false,
    prepare: true
  };

  options = _.defaultsDeep(options, defaults);

  // set raw true if select is used,
  // because casting to model instances may lead to problems
  if (options.select) options.raw = true;

  var queryParams = [];

  var query = void 0;
  try {
    var findQuery = this.get_find_query(queryObject, options);
    query = findQuery.query;
    queryParams = queryParams.concat(findQuery.params);
  } catch (e) {
    parser.callback_or_throw(e, callback);
    return {};
  }

  if (options.return_query) {
    return { query, params: queryParams };
  }

  var queryOptions = normalizer.normalize_query_option(options);

  this._execute_table_query(query, queryParams, queryOptions, function (err, results) {
    if (err) {
      callback(buildError('model.find.dberror', err));
      return;
    }
    if (!options.raw) {
      var ModelConstructor = _this6._properties.get_constructor();
      results = results.rows.map(function (res) {
        delete res.columns;
        var o = new ModelConstructor(res);
        o._modified = {};
        return o;
      });
      callback(null, results);
    } else {
      results = results.rows.map(function (res) {
        delete res.columns;
        return res;
      });
      callback(null, results);
    }
  });

  return {};
};

BaseModel.findOne = function f(queryObject, options, callback) {
  if (arguments.length === 2 && typeof options === 'function') {
    callback = options;
    options = {};
  }
  if (typeof callback !== 'function' && !options.return_query) {
    throw buildError('model.find.cberror');
  }

  queryObject.$limit = 1;

  return this.find(queryObject, options, function (err, results) {
    if (err) {
      callback(err);
      return;
    }
    if (results.length > 0) {
      callback(null, results[0]);
      return;
    }
    callback();
  });
};

BaseModel.update = function f(queryObject, updateValues, options, callback) {
  if (arguments.length === 3 && typeof options === 'function') {
    callback = options;
    options = {};
  }

  var schema = this._properties.schema;

  var defaults = {
    prepare: true
  };

  options = _.defaultsDeep(options, defaults);

  if (typeof schema.before_update === 'function' && schema.before_update(queryObject, updateValues, options) === false) {
    parser.callback_or_throw(buildError('model.update.before.error'), callback);
    return {};
  }

  var _parser$get_update_va = parser.get_update_value_expression(this, schema, updateValues, callback),
      updateClauses = _parser$get_update_va.updateClauses,
      queryParams = _parser$get_update_va.queryParams,
      errorHappened = _parser$get_update_va.errorHappened;

  if (errorHappened) return {};

  var query = 'UPDATE "%s"';
  var where = '';
  var finalParams = queryParams;
  if (options.ttl) query += util.format(' USING TTL %s', options.ttl);
  query += ' SET %s %s';
  try {
    var whereClause = parser.get_where_clause(schema, queryObject);
    where = whereClause.query;
    finalParams = finalParams.concat(whereClause.params);
  } catch (e) {
    parser.callback_or_throw(e, callback);
    return {};
  }

  query = util.format(query, this._properties.table_name, updateClauses.join(', '), where);

  if (options.conditions) {
    var ifClause = parser.get_if_clause(schema, options.conditions);
    if (ifClause.query) {
      query += util.format(' %s', ifClause.query);
      finalParams = finalParams.concat(ifClause.params);
    }
  } else if (options.if_exists) {
    query += ' IF EXISTS';
  }

  query += ';';

  if (options.return_query) {
    var returnObj = {
      query,
      params: finalParams,
      after_hook: function after_hook() {
        if (typeof schema.after_update === 'function' && schema.after_update(queryObject, updateValues, options) === false) {
          return buildError('model.update.after.error');
        }
        return true;
      }
    };
    return returnObj;
  }

  var queryOptions = normalizer.normalize_query_option(options);

  this._execute_table_query(query, finalParams, queryOptions, function (err, results) {
    if (typeof callback === 'function') {
      if (err) {
        callback(buildError('model.update.dberror', err));
        return;
      }
      if (typeof schema.after_update === 'function' && schema.after_update(queryObject, updateValues, options) === false) {
        callback(buildError('model.update.after.error'));
        return;
      }
      callback(null, results);
    } else if (err) {
      throw buildError('model.update.dberror', err);
    } else if (typeof schema.after_update === 'function' && schema.after_update(queryObject, updateValues, options) === false) {
      throw buildError('model.update.after.error');
    }
  });

  return {};
};

BaseModel.delete = function f(queryObject, options, callback) {
  if (arguments.length === 2 && typeof options === 'function') {
    callback = options;
    options = {};
  }

  var schema = this._properties.schema;

  var defaults = {
    prepare: true
  };

  options = _.defaultsDeep(options, defaults);

  if (typeof schema.before_delete === 'function' && schema.before_delete(queryObject, options) === false) {
    parser.callback_or_throw(buildError('model.delete.before.error'), callback);
    return {};
  }

  var queryParams = [];

  var query = 'DELETE FROM "%s" %s;';
  var where = '';
  try {
    var whereClause = parser.get_where_clause(schema, queryObject);
    where = whereClause.query;
    queryParams = queryParams.concat(whereClause.params);
  } catch (e) {
    parser.callback_or_throw(e, callback);
    return {};
  }

  query = util.format(query, this._properties.table_name, where);

  if (options.return_query) {
    var returnObj = {
      query,
      params: queryParams,
      after_hook: function after_hook() {
        if (typeof schema.after_delete === 'function' && schema.after_delete(queryObject, options) === false) {
          return buildError('model.delete.after.error');
        }
        return true;
      }
    };
    return returnObj;
  }

  var queryOptions = normalizer.normalize_query_option(options);

  this._execute_table_query(query, queryParams, queryOptions, function (err, results) {
    if (typeof callback === 'function') {
      if (err) {
        callback(buildError('model.delete.dberror', err));
        return;
      }
      if (typeof schema.after_delete === 'function' && schema.after_delete(queryObject, options) === false) {
        callback(buildError('model.delete.after.error'));
        return;
      }
      callback(null, results);
    } else if (err) {
      throw buildError('model.delete.dberror', err);
    } else if (typeof schema.after_delete === 'function' && schema.after_delete(queryObject, options) === false) {
      throw buildError('model.delete.after.error');
    }
  });

  return {};
};

BaseModel.truncate = function f(callback) {
  var properties = this._properties;
  var tableName = properties.table_name;

  var query = util.format('TRUNCATE TABLE "%s";', tableName);
  this._execute_table_query(query, [], callback);
};

BaseModel.prototype.get_data_types = function f() {
  return cql.types;
};

BaseModel.prototype.get_table_name = function f() {
  return this.constructor.get_table_name();
};

BaseModel.prototype.get_keyspace_name = function f() {
  return this.constructor.get_keyspace_name();
};

BaseModel.prototype._get_default_value = function f(fieldname) {
  var properties = this.constructor._properties;
  var schema = properties.schema;

  if (_.isPlainObject(schema.fields[fieldname]) && schema.fields[fieldname].default !== undefined) {
    if (typeof schema.fields[fieldname].default === 'function') {
      return schema.fields[fieldname].default.call(this);
    }
    return schema.fields[fieldname].default;
  }
  return undefined;
};

BaseModel.prototype.validate = function f(propertyName, value) {
  value = value || this[propertyName];
  this._validators = this._validators || {};
  return schemer.get_validation_message(this._validators[propertyName] || [], value);
};

BaseModel.prototype.save = function fn(options, callback) {
  var _this7 = this;

  if (arguments.length === 1 && typeof options === 'function') {
    callback = options;
    options = {};
  }

  var properties = this.constructor._properties;
  var schema = properties.schema;

  var defaults = {
    prepare: true
  };

  options = _.defaultsDeep(options, defaults);

  if (typeof schema.before_save === 'function' && schema.before_save(this, options) === false) {
    parser.callback_or_throw(buildError('model.save.before.error'), callback);
    return {};
  }

  var _parser$get_save_valu = parser.get_save_value_expression(this, schema, callback),
      identifiers = _parser$get_save_valu.identifiers,
      values = _parser$get_save_valu.values,
      queryParams = _parser$get_save_valu.queryParams,
      errorHappened = _parser$get_save_valu.errorHappened;

  if (errorHappened) return {};

  var query = util.format('INSERT INTO "%s" ( %s ) VALUES ( %s )', properties.table_name, identifiers.join(' , '), values.join(' , '));

  if (options.if_not_exist) query += ' IF NOT EXISTS';
  if (options.ttl) query += util.format(' USING TTL %s', options.ttl);

  query += ';';

  if (options.return_query) {
    var returnObj = {
      query,
      params: queryParams,
      after_hook: function after_hook() {
        if (typeof schema.after_save === 'function' && schema.after_save(_this7, options) === false) {
          return buildError('model.save.after.error');
        }
        return true;
      }
    };
    return returnObj;
  }

  var queryOptions = normalizer.normalize_query_option(options);

  this.constructor._execute_table_query(query, queryParams, queryOptions, function (err, result) {
    if (typeof callback === 'function') {
      if (err) {
        callback(buildError('model.save.dberror', err));
        return;
      }
      if (!options.if_not_exist || result.rows && result.rows[0] && result.rows[0]['[applied]']) {
        _this7._modified = {};
      }
      if (typeof schema.after_save === 'function' && schema.after_save(_this7, options) === false) {
        callback(buildError('model.save.after.error'));
        return;
      }
      callback(null, result);
    } else if (err) {
      throw buildError('model.save.dberror', err);
    } else if (typeof schema.after_save === 'function' && schema.after_save(_this7, options) === false) {
      throw buildError('model.save.after.error');
    }
  });

  return {};
};

BaseModel.prototype.delete = function f(options, callback) {
  if (arguments.length === 1 && typeof options === 'function') {
    callback = options;
    options = {};
  }

  var schema = this.constructor._properties.schema;
  var deleteQuery = {};

  for (var i = 0; i < schema.key.length; i++) {
    var fieldKey = schema.key[i];
    if (_.isArray(fieldKey)) {
      for (var j = 0; j < fieldKey.length; j++) {
        deleteQuery[fieldKey[j]] = this[fieldKey[j]];
      }
    } else {
      deleteQuery[fieldKey] = this[fieldKey];
    }
  }

  return this.constructor.delete(deleteQuery, options, callback);
};

BaseModel.prototype.toJSON = function toJSON() {
  var _this8 = this;

  var object = {};
  var schema = this.constructor._properties.schema;

  Object.keys(schema.fields).forEach(function (field) {
    object[field] = _this8[field];
  });

  return object;
};

BaseModel.prototype.isModified = function isModified(propName) {
  if (propName) {
    return Object.prototype.hasOwnProperty.call(this._modified, propName);
  }
  return Object.keys(this._modified).length !== 0;
};

module.exports = BaseModel;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9vcm0vYmFzZV9tb2RlbC5qcyJdLCJuYW1lcyI6WyJQcm9taXNlIiwicmVxdWlyZSIsIl8iLCJ1dGlsIiwiZHNlRHJpdmVyIiwiZSIsImNxbCIsInByb21pc2lmeUFsbCIsImJ1aWxkRXJyb3IiLCJzY2hlbWVyIiwibm9ybWFsaXplciIsInBhcnNlciIsIlRhYmxlQnVpbGRlciIsIkVsYXNzYW5kcmFCdWlsZGVyIiwiSmFudXNHcmFwaEJ1aWxkZXIiLCJEcml2ZXIiLCJCYXNlTW9kZWwiLCJmIiwiaW5zdGFuY2VWYWx1ZXMiLCJmaWVsZFZhbHVlcyIsImZpZWxkcyIsImNvbnN0cnVjdG9yIiwiX3Byb3BlcnRpZXMiLCJzY2hlbWEiLCJtZXRob2RzIiwibW9kZWwiLCJkZWZhdWx0U2V0dGVyIiwiZjEiLCJwcm9wTmFtZSIsIm5ld1ZhbHVlIiwiX21vZGlmaWVkIiwiZGVmYXVsdEdldHRlciIsIl92YWxpZGF0b3JzIiwiZmllbGRzS2V5cyIsIk9iamVjdCIsImtleXMiLCJpIiwibGVuIiwibGVuZ3RoIiwicHJvcGVydHlOYW1lIiwiZmllbGQiLCJnZXRfdmFsaWRhdG9ycyIsIm1lc3NhZ2UiLCJzZXR0ZXIiLCJiaW5kIiwiZ2V0dGVyIiwidmlydHVhbCIsInNldCIsImdldCIsImRlc2NyaXB0b3IiLCJlbnVtZXJhYmxlIiwiZGVmaW5lUHJvcGVydHkiLCJtZXRob2ROYW1lcyIsIm1ldGhvZE5hbWUiLCJtZXRob2QiLCJuYW1lIiwiX3NldF9wcm9wZXJ0aWVzIiwicHJvcGVydGllcyIsInRhYmxlTmFtZSIsInRhYmxlX25hbWUiLCJ2YWxpZGF0ZV90YWJsZV9uYW1lIiwicXVhbGlmaWVkVGFibGVOYW1lIiwiZm9ybWF0Iiwia2V5c3BhY2UiLCJxdWFsaWZpZWRfdGFibGVfbmFtZSIsIl9kcml2ZXIiLCJfc3luY19tb2RlbF9kZWZpbml0aW9uIiwiY2FsbGJhY2siLCJtb2RlbFNjaGVtYSIsIm1pZ3JhdGlvbiIsInRhYmxlQnVpbGRlciIsImRyb3BUYWJsZU9uU2NoZW1hQ2hhbmdlIiwicHJvY2VzcyIsImVudiIsIk5PREVfRU5WIiwiZ2V0X3RhYmxlX3NjaGVtYSIsImVyciIsImRiU2NoZW1hIiwiYWZ0ZXJEQkNyZWF0ZSIsImVycjEiLCJpbmRleGluZ1Rhc2tzIiwiaXNBcnJheSIsImluZGV4ZXMiLCJjcmVhdGVJbmRleGVzQXN5bmMiLCJwcm9taXNpZnkiLCJjcmVhdGVfaW5kZXhlcyIsInB1c2giLCJjdXN0b21faW5kZXhlcyIsImNyZWF0ZUN1c3RvbUluZGV4ZXNBc3luYyIsImNyZWF0ZV9jdXN0b21faW5kZXhlcyIsImN1c3RvbV9pbmRleCIsImNyZWF0ZUN1c3RvbUluZGV4QXN5bmMiLCJtYXRlcmlhbGl6ZWRfdmlld3MiLCJjcmVhdGVWaWV3c0FzeW5jIiwiY3JlYXRlX212aWV3cyIsImFsbCIsInRoZW4iLCJjYXRjaCIsImVycjIiLCJjcmVhdGVUYWJsZSIsImNyZWF0ZV90YWJsZSIsIm5vcm1hbGl6ZWRNb2RlbFNjaGVtYSIsIm5vcm1hbGl6ZWREQlNjaGVtYSIsIm5vcm1hbGl6ZV9tb2RlbF9zY2hlbWEiLCJpc0VxdWFsIiwia2V5IiwiY2x1c3RlcmluZ19vcmRlciIsImluaXRfYWx0ZXJfb3BlcmF0aW9ucyIsImRyb3BfcmVjcmVhdGVfdGFibGUiLCJfc3luY19lc19pbmRleCIsImVzY2xpZW50IiwiZXNfaW5kZXhfbWFwcGluZyIsImtleXNwYWNlTmFtZSIsIm1hcHBpbmdOYW1lIiwiaW5kZXhOYW1lIiwiZWxhc3NhbmRyYUJ1aWxkZXIiLCJhc3NlcnRfaW5kZXgiLCJwdXRfbWFwcGluZyIsIl9zeW5jX2dyYXBoIiwiZ3JlbWxpbl9jbGllbnQiLCJncmFwaF9tYXBwaW5nIiwiZ3JhcGhOYW1lIiwiZ3JhcGhCdWlsZGVyIiwiYXNzZXJ0X2dyYXBoIiwiX2V4ZWN1dGVfdGFibGVfcXVlcnkiLCJxdWVyeSIsInBhcmFtcyIsIm9wdGlvbnMiLCJhcmd1bWVudHMiLCJkZWZhdWx0cyIsInByZXBhcmUiLCJkZWZhdWx0c0RlZXAiLCJkb0V4ZWN1dGVRdWVyeSIsImRvcXVlcnkiLCJkb2NhbGxiYWNrIiwiZXhlY3V0ZV9xdWVyeSIsImlzX3RhYmxlX3JlYWR5IiwiaW5pdCIsImdldF9maW5kX3F1ZXJ5IiwicXVlcnlPYmplY3QiLCJvcmRlcmJ5Q2xhdXNlIiwiZ2V0X29yZGVyYnlfY2xhdXNlIiwibGltaXRDbGF1c2UiLCJnZXRfbGltaXRfY2xhdXNlIiwid2hlcmVDbGF1c2UiLCJnZXRfd2hlcmVfY2xhdXNlIiwic2VsZWN0Q2xhdXNlIiwiZ2V0X3NlbGVjdF9jbGF1c2UiLCJkaXN0aW5jdCIsIm1hdGVyaWFsaXplZF92aWV3IiwiYWxsb3dfZmlsdGVyaW5nIiwiZ2V0X3RhYmxlX25hbWUiLCJnZXRfa2V5c3BhY2VfbmFtZSIsIl9yZWFkeSIsInVuZGVmaW5lZCIsInN5bmNEQiIsInJlc3VsdCIsImdldF9jcWxfY2xpZW50IiwiZW5zdXJlX2luaXQiLCJnZXRfZXNfY2xpZW50IiwiRXJyb3IiLCJnZXRfZ3JlbWxpbl9jbGllbnQiLCJleGVjdXRlX2JhdGNoIiwiZXhlY3V0ZV9lYWNoUm93IiwiX2V4ZWN1dGVfdGFibGVfZWFjaFJvdyIsIm9uUmVhZGFibGUiLCJlYWNoUm93IiwiY2IiLCJyYXciLCJyZXR1cm5fcXVlcnkiLCJzZWxlY3RRdWVyeSIsImZpbmQiLCJxdWVyeU9wdGlvbnMiLCJub3JtYWxpemVfcXVlcnlfb3B0aW9uIiwibiIsInJvdyIsIk1vZGVsQ29uc3RydWN0b3IiLCJnZXRfY29uc3RydWN0b3IiLCJleGVjdXRlX3N0cmVhbSIsIl9leGVjdXRlX3RhYmxlX3N0cmVhbSIsInN0cmVhbSIsInNlbGYiLCJyZWFkZXIiLCJyZWFkUm93IiwicmVhZCIsIm8iLCJfZXhlY3V0ZV9ncmVtbGluX3F1ZXJ5Iiwic2NyaXB0IiwiYmluZGluZ3MiLCJncmVtbGluQ2xpZW50IiwiZXhlY3V0ZSIsInJlc3VsdHMiLCJfZXhlY3V0ZV9ncmVtbGluX3NjcmlwdCIsImNyZWF0ZVZlcnRleCIsInZlcnRleFByb3BlcnRpZXMiLCJfX2dyYXBoTmFtZSIsIl9fdmVydGV4TGFiZWwiLCJmb3JFYWNoIiwicHJvcGVydHkiLCJnZXRWZXJ0ZXgiLCJfX3ZlcnRleElkIiwidXBkYXRlVmVydGV4IiwiZGVsZXRlVmVydGV4IiwiY3JlYXRlRWRnZSIsIl9fZWRnZUxhYmVsIiwiX19mcm9tVmVydGV4SWQiLCJfX3RvVmVydGV4SWQiLCJlZGdlUHJvcGVydGllcyIsImdldEVkZ2UiLCJfX2VkZ2VJZCIsInVwZGF0ZUVkZ2UiLCJkZWxldGVFZGdlIiwiZ3JhcGhRdWVyeSIsInNlYXJjaCIsImVzQ2xpZW50IiwiaW5kZXgiLCJ0eXBlIiwicmVzcG9uc2UiLCJzZWxlY3QiLCJxdWVyeVBhcmFtcyIsImZpbmRRdWVyeSIsImNvbmNhdCIsImNhbGxiYWNrX29yX3Rocm93Iiwicm93cyIsIm1hcCIsInJlcyIsImNvbHVtbnMiLCJmaW5kT25lIiwiJGxpbWl0IiwidXBkYXRlIiwidXBkYXRlVmFsdWVzIiwiYmVmb3JlX3VwZGF0ZSIsImdldF91cGRhdGVfdmFsdWVfZXhwcmVzc2lvbiIsInVwZGF0ZUNsYXVzZXMiLCJlcnJvckhhcHBlbmVkIiwid2hlcmUiLCJmaW5hbFBhcmFtcyIsInR0bCIsImpvaW4iLCJjb25kaXRpb25zIiwiaWZDbGF1c2UiLCJnZXRfaWZfY2xhdXNlIiwiaWZfZXhpc3RzIiwicmV0dXJuT2JqIiwiYWZ0ZXJfaG9vayIsImFmdGVyX3VwZGF0ZSIsImRlbGV0ZSIsImJlZm9yZV9kZWxldGUiLCJhZnRlcl9kZWxldGUiLCJ0cnVuY2F0ZSIsInByb3RvdHlwZSIsImdldF9kYXRhX3R5cGVzIiwidHlwZXMiLCJfZ2V0X2RlZmF1bHRfdmFsdWUiLCJmaWVsZG5hbWUiLCJpc1BsYWluT2JqZWN0IiwiZGVmYXVsdCIsImNhbGwiLCJ2YWxpZGF0ZSIsInZhbHVlIiwiZ2V0X3ZhbGlkYXRpb25fbWVzc2FnZSIsInNhdmUiLCJmbiIsImJlZm9yZV9zYXZlIiwiZ2V0X3NhdmVfdmFsdWVfZXhwcmVzc2lvbiIsImlkZW50aWZpZXJzIiwidmFsdWVzIiwiaWZfbm90X2V4aXN0IiwiYWZ0ZXJfc2F2ZSIsImRlbGV0ZVF1ZXJ5IiwiZmllbGRLZXkiLCJqIiwidG9KU09OIiwib2JqZWN0IiwiaXNNb2RpZmllZCIsImhhc093blByb3BlcnR5IiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6Ijs7QUFBQSxJQUFNQSxVQUFVQyxRQUFRLFVBQVIsQ0FBaEI7QUFDQSxJQUFNQyxJQUFJRCxRQUFRLFFBQVIsQ0FBVjtBQUNBLElBQU1FLE9BQU9GLFFBQVEsTUFBUixDQUFiOztBQUVBLElBQUlHLGtCQUFKO0FBQ0EsSUFBSTtBQUNGO0FBQ0FBLGNBQVlILFFBQVEsWUFBUixDQUFaO0FBQ0QsQ0FIRCxDQUdFLE9BQU9JLENBQVAsRUFBVTtBQUNWRCxjQUFZLElBQVo7QUFDRDs7QUFFRCxJQUFNRSxNQUFNTixRQUFRTyxZQUFSLENBQXFCSCxhQUFhSCxRQUFRLGtCQUFSLENBQWxDLENBQVo7O0FBRUEsSUFBTU8sYUFBYVAsUUFBUSxtQkFBUixDQUFuQjtBQUNBLElBQU1RLFVBQVVSLFFBQVEsc0JBQVIsQ0FBaEI7QUFDQSxJQUFNUyxhQUFhVCxRQUFRLHFCQUFSLENBQW5CO0FBQ0EsSUFBTVUsU0FBU1YsUUFBUSxpQkFBUixDQUFmOztBQUVBLElBQU1XLGVBQWVYLFFBQVEsbUJBQVIsQ0FBckI7QUFDQSxJQUFNWSxvQkFBb0JaLFFBQVEsd0JBQVIsQ0FBMUI7QUFDQSxJQUFNYSxvQkFBb0JiLFFBQVEsd0JBQVIsQ0FBMUI7QUFDQSxJQUFNYyxTQUFTZCxRQUFRLG1CQUFSLENBQWY7O0FBRUEsSUFBTWUsWUFBWSxTQUFTQyxDQUFULENBQVdDLGNBQVgsRUFBMkI7QUFDM0NBLG1CQUFpQkEsa0JBQWtCLEVBQW5DO0FBQ0EsTUFBTUMsY0FBYyxFQUFwQjtBQUNBLE1BQU1DLFNBQVMsS0FBS0MsV0FBTCxDQUFpQkMsV0FBakIsQ0FBNkJDLE1BQTdCLENBQW9DSCxNQUFuRDtBQUNBLE1BQU1JLFVBQVUsS0FBS0gsV0FBTCxDQUFpQkMsV0FBakIsQ0FBNkJDLE1BQTdCLENB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QixDQUFnQ2xCLElBQWhDLENBQXFDLEtBQUtuTyxTQUExQyxFQUFxREYsUUFBckQsQ0FBUDtBQUNEO0FBQ0QsU0FBT00sT0FBT0MsSUFBUCxDQUFZLEtBQUtMLFNBQWpCLEVBQTRCUSxNQUE1QixLQUF1QyxDQUE5QztBQUNELENBTEQ7O0FBT0E4TyxPQUFPQyxPQUFQLEdBQWlCclEsU0FBakIiLCJmaWxlIjoiYmFzZV9tb2RlbC5qcyIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IFByb21pc2UgPSByZXF1aXJlKCdibHVlYmlyZCcpO1xuY29uc3QgXyA9IHJlcXVpcmUoJ2xvZGFzaCcpO1xuY29uc3QgdXRpbCA9IHJlcXVpcmUoJ3V0aWwnKTtcblxubGV0IGRzZURyaXZlcjtcbnRyeSB7XG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBpbXBvcnQvbm8tZXh0cmFuZW91cy1kZXBlbmRlbmNpZXMsIGltcG9ydC9uby11bnJlc29sdmVkXG4gIGRzZURyaXZlciA9IHJlcXVpcmUoJ2RzZS1kcml2ZXInKTtcbn0gY2F0Y2ggKGUpIHtcbiAgZHNlRHJpdmVyID0gbnVsbDtcbn1cblxuY29uc3QgY3FsID0gUHJvbWlzZS5wcm9taXNpZnlBbGwoZHNlRHJpdmVyIHx8IHJlcXVpcmUoJ2Nhc3NhbmRyYS1kcml2ZXInKSk7XG5cbmNvbnN0IGJ1aWxkRXJyb3IgPSByZXF1aXJlKCcuL2Fwb2xsb19lcnJvci5qcycpO1xuY29uc3Qgc2NoZW1lciA9IHJlcXVpcmUoJy4uL3ZhbGlkYXRvcnMvc2NoZW1hJyk7XG5jb25zdCBub3JtYWxpemVyID0gcmVxdWlyZSgnLi4vdXRpbHMvbm9ybWFsaXplcicpO1xuY29uc3QgcGFyc2VyID0gcmVxdWlyZSgnLi4vdXRpbHMvcGFyc2VyJyk7XG5cbmNvbnN0IFRhYmxlQnVpbGRlciA9IHJlcXVpcmUoJy4uL2J1aWxkZXJzL3RhYmxlJyk7XG5jb25zdCBFbGFzc2FuZHJhQnVpbGRlciA9IHJlcXVpcmUoJy4uL2J1aWxkZXJzL2VsYXNzYW5kcmEnKTtcbmNvbnN0IEphbnVzR3JhcGhCdWlsZGVyID0gcmVxdWlyZSgnLi4vYnVpbGRlcnMvamFudXNncmFwaCcpO1xuY29uc3QgRHJpdmVyID0gcmVxdWlyZSgnLi4vaGVscGVycy9kcml2ZXInKTtcblxuY29uc3QgQmFzZU1vZGVsID0gZnVuY3Rpb24gZihpbnN0YW5jZVZhbHVlcykge1xuICBpbnN0YW5jZVZhbHVlcyA9IGluc3RhbmNlVmFsdWVzIHx8IHt9O1xuICBjb25zdCBmaWVsZFZhbHVlcyA9IHt9O1xuICBjb25zdCBmaWVsZHMgPSB0aGlzLmNvbnN0cnVjdG9yLl9wcm9wZXJ0aWVzLnNjaGVtYS5maWVsZHM7XG4gIGNvbnN0IG1ldGhvZHMgPSB0aGlzLmNvbnN0cnVjdG9yLl9wcm9wZXJ0aWVzLnNjaGVtYS5tZXRob2RzIHx8IHt9O1xuICBjb25zdCBtb2RlbCA9IHRoaXM7XG5cbiAgY29uc3QgZGVmYXVsdFNldHRlciA9IGZ1bmN0aW9uIGYxKHByb3BOYW1lLCBuZXdWYWx1ZSkge1xuICAgIGlmICh0aGlzW3Byb3BOYW1lXSAhPT0gbmV3VmFsdWUpIHtcbiAgICAgIG1vZGVsLl9tb2RpZmllZFtwcm9wTmFtZV0gPSB0cnVlO1xuICAgIH1cbiAgICB0aGlzW3Byb3BOYW1lXSA9IG5ld1ZhbHVlO1xuICB9O1xuXG4gIGNvbnN0IGRlZmF1bHRHZXR0ZXIgPSBmdW5jdGlvbiBmMShwcm9wTmFtZSkge1xuICAgIHJldHVybiB0aGlzW3Byb3BOYW1lXTtcbiAgfTtcblxuICB0aGlzLl9tb2RpZmllZCA9IHt9O1xuICB0aGlzLl92YWxpZGF0b3JzID0ge307XG5cbiAgZm9yIChsZXQgZmllbGRzS2V5cyA9IE9iamVjdC5rZXlzKGZpZWxkcyksIGkgPSAwLCBsZW4gPSBmaWVsZHNLZXlzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgY29uc3QgcHJvcGVydHlOYW1lID0gZmllbGRzS2V5c1tpXTtcbiAgICBjb25zdCBmaWVsZCA9IGZpZWxkc1tmaWVsZHNLZXlzW2ldXTtcblxuICAgIHRyeSB7XG4gICAgICB0aGlzLl92YWxpZGF0b3JzW3Byb3BlcnR5TmFtZV0gPSBzY2hlbWVyLmdldF92YWxpZGF0b3JzKHRoaXMuY29uc3RydWN0b3IuX3Byb3BlcnRpZXMuc2NoZW1hLCBwcm9wZXJ0eU5hbWUpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIHRocm93IChidWlsZEVycm9yKCdtb2RlbC52YWxpZGF0b3IuaW52YWxpZHNjaGVtYScsIGUubWVzc2FnZSkpO1xuICAgIH1cblxuICAgIGxldCBzZXR0ZXIgPSBkZWZhdWx0U2V0dGVyLmJpbmQoZmllbGRWYWx1ZXMsIHByb3BlcnR5TmFtZSk7XG4gICAgbGV0IGdldHRlciA9IGRlZmF1bHRHZXR0ZXIuYmluZChmaWVsZFZhbHVlcywgcHJvcGVydHlOYW1lKTtcblxuICAgIGlmIChmaWVsZC52aXJ0dWFsICYmIHR5cGVvZiBmaWVsZC52aXJ0dWFsLnNldCA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgc2V0dGVyID0gZmllbGQudmlydHVhbC5zZXQuYmluZChmaWVsZFZhbHVlcyk7XG4gICAgfVxuXG4gICAgaWYgKGZpZWxkLnZpcnR1YWwgJiYgdHlwZW9mIGZpZWxkLnZpcnR1YWwuZ2V0ID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICBnZXR0ZXIgPSBmaWVsZC52aXJ0dWFsLmdldC5iaW5kKGZpZWxkVmFsdWVzKTtcbiAgICB9XG5cbiAgICBjb25zdCBkZXNjcmlwdG9yID0ge1xuICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgIHNldDogc2V0dGVyLFxuICAgICAgZ2V0OiBnZXR0ZXIsXG4gICAgfTtcblxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBwcm9wZXJ0eU5hbWUsIGRlc2NyaXB0b3IpO1xuICAgIGlmICghZmllbGQudmlydHVhbCkge1xuICAgICAgdGhpc1twcm9wZXJ0eU5hbWVdID0gaW5zdGFuY2VWYWx1ZXNbcHJvcGVydHlOYW1lXTtcbiAgICB9XG4gIH1cblxuICBmb3IgKGxldCBtZXRob2ROYW1lcyA9IE9iamVjdC5rZXlzKG1ldGhvZHMpLCBpID0gMCwgbGVuID0gbWV0aG9kTmFtZXMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICBjb25zdCBtZXRob2ROYW1lID0gbWV0aG9kTmFtZXNbaV07XG4gICAgY29uc3QgbWV0aG9kID0gbWV0aG9kc1ttZXRob2ROYW1lXTtcbiAgICB0aGlzW21ldGhvZE5hbWVdID0gbWV0aG9kO1xuICB9XG59O1xuXG5CYXNlTW9kZWwuX3Byb3BlcnRpZXMgPSB7XG4gIG5hbWU6IG51bGwsXG4gIHNjaGVtYTogbnVsbCxcbn07XG5cbkJhc2VNb2RlbC5fc2V0X3Byb3BlcnRpZXMgPSBmdW5jdGlvbiBmKHByb3BlcnRpZXMpIHtcbiAgY29uc3Qgc2NoZW1hID0gcHJvcGVydGllcy5zY2hlbWE7XG4gIGNvbnN0IHRhYmxlTmFtZSA9IHNjaGVtYS50YWJsZV9uYW1lIHx8IHByb3BlcnRpZXMubmFtZTtcblxuICBpZiAoIXNjaGVtZXIudmFsaWRhdGVfdGFibGVfbmFtZSh0YWJsZU5hbWUpKSB7XG4gICAgdGhyb3cgKGJ1aWxkRXJyb3IoJ21vZGVsLnRhYmxlY3JlYXRpb24uaW52YWxpZG5hbWUnLCB0YWJsZU5hbWUpKTtcbiAgfVxuXG4gIGNvbnN0IHF1YWxpZmllZFRhYmxlTmFtZSA9IHV0aWwuZm9ybWF0KCdcIiVzXCIuXCIlc1wiJywgcHJvcGVydGllcy5rZXlzcGFjZSwgdGFibGVOYW1lKTtcblxuICB0aGlzLl9wcm9wZXJ0aWVzID0gcHJvcGVydGllcztcbiAgdGhpcy5fcHJvcGVydGllcy50YWJsZV9uYW1lID0gdGFibGVOYW1lO1xuICB0aGlzLl9wcm9wZXJ0aWVzLnF1YWxpZmllZF90YWJsZV9uYW1lID0gcXVhbGlmaWVkVGFibGVOYW1lO1xuICB0aGlzLl9kcml2ZXIgPSBuZXcgRHJpdmVyKHRoaXMuX3Byb3BlcnRpZXMpO1xufTtcblxuQmFzZU1vZGVsLl9zeW5jX21vZGVsX2RlZmluaXRpb24gPSBmdW5jdGlvbiBmKGNhbGxiYWNrKSB7XG4gIGNvbnN0IHByb3BlcnRpZXMgPSB0aGlzLl9wcm9wZXJ0aWVzO1xuICBjb25zdCB0YWJsZU5hbWUgPSBwcm9wZXJ0aWVzLnRhYmxlX25hbWU7XG4gIGNvbnN0IG1vZGVsU2NoZW1hID0gcHJvcGVydGllcy5zY2hlbWE7XG4gIGxldCBtaWdyYXRpb24gPSBwcm9wZXJ0aWVzLm1pZ3JhdGlvbjtcblxuICBjb25zdCB0YWJsZUJ1aWxkZXIgPSBuZXcgVGFibGVCdWlsZGVyKHRoaXMuX2RyaXZlciwgdGhpcy5fcHJvcGVydGllcyk7XG5cbiAgLy8gYmFja3dhcmRzIGNvbXBhdGlibGUgY2hhbmdlLCBkcm9wVGFibGVPblNjaGVtYUNoYW5nZSB3aWxsIHdvcmsgbGlrZSBtaWdyYXRpb246ICdkcm9wJ1xuICBpZiAoIW1pZ3JhdGlvbikge1xuICAgIGlmIChwcm9wZXJ0aWVzLmRyb3BUYWJsZU9uU2NoZW1hQ2hhbmdlKSBtaWdyYXRpb24gPSAnZHJvcCc7XG4gICAgZWxzZSBtaWdyYXRpb24gPSAnc2FmZSc7XG4gIH1cbiAgLy8gYWx3YXlzIHNhZmUgbWlncmF0ZSBpZiBOT0RFX0VOVj09PSdwcm9kdWN0aW9uJ1xuICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdwcm9kdWN0aW9uJykgbWlncmF0aW9uID0gJ3NhZmUnO1xuXG4gIC8vIGNoZWNrIGZvciBleGlzdGVuY2Ugb2YgdGFibGUgb24gREIgYW5kIGlmIGl0IG1hdGNoZXMgdGhpcyBtb2RlbCdzIHNjaGVtYVxuICB0YWJsZUJ1aWxkZXIuZ2V0X3RhYmxlX3NjaGVtYSgoZXJyLCBkYlNjaGVtYSkgPT4ge1xuICAgIGlmIChlcnIpIHtcbiAgICAgIGNhbGxiYWNrKGVycik7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgYWZ0ZXJEQkNyZWF0ZSA9IChlcnIxKSA9PiB7XG4gICAgICBpZiAoZXJyMSkge1xuICAgICAgICBjYWxsYmFjayhlcnIxKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBpbmRleGluZ1Rhc2tzID0gW107XG5cbiAgICAgIC8vIGNhc3NhbmRyYSBpbmRleCBjcmVhdGUgaWYgZGVmaW5lZFxuICAgICAgaWYgKF8uaXNBcnJheShtb2RlbFNjaGVtYS5pbmRleGVzKSkge1xuICAgICAgICB0YWJsZUJ1aWxkZXIuY3JlYXRlSW5kZXhlc0FzeW5jID0gUHJvbWlzZS5wcm9taXNpZnkodGFibGVCdWlsZGVyLmNyZWF0ZV9pbmRleGVzKTtcbiAgICAgICAgaW5kZXhpbmdUYXNrcy5wdXNoKHRhYmxlQnVpbGRlci5jcmVhdGVJbmRleGVzQXN5bmMobW9kZWxTY2hlbWEuaW5kZXhlcykpO1xuICAgICAgfVxuICAgICAgLy8gY2Fzc2FuZHJhIGN1c3RvbSBpbmRleCBjcmVhdGUgaWYgZGVmaW5lZFxuICAgICAgaWYgKF8uaXNBcnJheShtb2RlbFNjaGVtYS5jdXN0b21faW5kZXhlcykpIHtcbiAgICAgICAgdGFibGVCdWlsZGVyLmNyZWF0ZUN1c3RvbUluZGV4ZXNBc3luYyA9IFByb21pc2UucHJvbWlzaWZ5KHRhYmxlQnVpbGRlci5jcmVhdGVfY3VzdG9tX2luZGV4ZXMpO1xuICAgICAgICBpbmRleGluZ1Rhc2tzLnB1c2godGFibGVCdWlsZGVyLmNyZWF0ZUN1c3RvbUluZGV4ZXNBc3luYyhtb2RlbFNjaGVtYS5jdXN0b21faW5kZXhlcykpO1xuICAgICAgfVxuICAgICAgaWYgKG1vZGVsU2NoZW1hLmN1c3RvbV9pbmRleCkge1xuICAgICAgICB0YWJsZUJ1aWxkZXIuY3JlYXRlQ3VzdG9tSW5kZXhBc3luYyA9IFByb21pc2UucHJvbWlzaWZ5KHRhYmxlQnVpbGRlci5jcmVhdGVfY3VzdG9tX2luZGV4ZXMpO1xuICAgICAgICBpbmRleGluZ1Rhc2tzLnB1c2godGFibGVCdWlsZGVyLmNyZWF0ZUN1c3RvbUluZGV4QXN5bmMoW21vZGVsU2NoZW1hLmN1c3RvbV9pbmRleF0pKTtcbiAgICAgIH1cbiAgICAgIC8vIG1hdGVyaWFsaXplZCB2aWV3IGNyZWF0ZSBpZiBkZWZpbmVkXG4gICAgICBpZiAobW9kZWxTY2hlbWEubWF0ZXJpYWxpemVkX3ZpZXdzKSB7XG4gICAgICAgIHRhYmxlQnVpbGRlci5jcmVhdGVWaWV3c0FzeW5jID0gUHJvbWlzZS5wcm9taXNpZnkodGFibGVCdWlsZGVyLmNyZWF0ZV9tdmlld3MpO1xuICAgICAgICBpbmRleGluZ1Rhc2tzLnB1c2godGFibGVCdWlsZGVyLmNyZWF0ZVZpZXdzQXN5bmMobW9kZWxTY2hlbWEubWF0ZXJpYWxpemVkX3ZpZXdzKSk7XG4gICAgICB9XG5cbiAgICAgIFByb21pc2UuYWxsKGluZGV4aW5nVGFza3MpXG4gICAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgICAvLyBkYiBzY2hlbWEgd2FzIHVwZGF0ZWQsIHNvIGNhbGxiYWNrIHdpdGggdHJ1ZVxuICAgICAgICAgIGNhbGxiYWNrKG51bGwsIHRydWUpO1xuICAgICAgICB9KVxuICAgICAgICAuY2F0Y2goKGVycjIpID0+IHtcbiAgICAgICAgICBjYWxsYmFjayhlcnIyKTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIGlmICghZGJTY2hlbWEpIHtcbiAgICAgIGlmIChwcm9wZXJ0aWVzLmNyZWF0ZVRhYmxlID09PSBmYWxzZSkge1xuICAgICAgICBjYWxsYmFjayhidWlsZEVycm9yKCdtb2RlbC50YWJsZWNyZWF0aW9uLnNjaGVtYW5vdGZvdW5kJywgdGFibGVOYW1lKSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIC8vIGlmIG5vdCBleGlzdGluZywgaXQncyBjcmVhdGVkXG4gICAgICB0YWJsZUJ1aWxkZXIuY3JlYXRlX3RhYmxlKG1vZGVsU2NoZW1hLCBhZnRlckRCQ3JlYXRlKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBsZXQgbm9ybWFsaXplZE1vZGVsU2NoZW1hO1xuICAgIGxldCBub3JtYWxpemVkREJTY2hlbWE7XG5cbiAgICB0cnkge1xuICAgICAgbm9ybWFsaXplZE1vZGVsU2NoZW1hID0gbm9ybWFsaXplci5ub3JtYWxpemVfbW9kZWxfc2NoZW1hKG1vZGVsU2NoZW1hKTtcbiAgICAgIG5vcm1hbGl6ZWREQlNjaGVtYSA9IG5vcm1hbGl6ZXIubm9ybWFsaXplX21vZGVsX3NjaGVtYShkYlNjaGVtYSk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgdGhyb3cgKGJ1aWxkRXJyb3IoJ21vZGVsLnZhbGlkYXRvci5pbnZhbGlkc2NoZW1hJywgZS5tZXNzYWdlKSk7XG4gICAgfVxuXG4gICAgaWYgKF8uaXNFcXVhbChub3JtYWxpemVkTW9kZWxTY2hlbWEsIG5vcm1hbGl6ZWREQlNjaGVtYSkpIHtcbiAgICAgIC8vIG5vIGNoYW5nZSBpbiBkYiB3YXMgbWFkZSwgc28gY2FsbGJhY2sgd2l0aCBmYWxzZVxuICAgICAgY2FsbGJhY2sobnVsbCwgZmFsc2UpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmIChtaWdyYXRpb24gPT09ICdhbHRlcicpIHtcbiAgICAgIC8vIGNoZWNrIGlmIHRhYmxlIGNhbiBiZSBhbHRlcmVkIHRvIG1hdGNoIHNjaGVtYVxuICAgICAgaWYgKF8uaXNFcXVhbChub3JtYWxpemVkTW9kZWxTY2hlbWEua2V5LCBub3JtYWxpemVkREJTY2hlbWEua2V5KSAmJlxuICAgICAgICAgIF8uaXNFcXVhbChub3JtYWxpemVkTW9kZWxTY2hlbWEuY2x1c3RlcmluZ19vcmRlciwgbm9ybWFsaXplZERCU2NoZW1hLmNsdXN0ZXJpbmdfb3JkZXIpKSB7XG4gICAgICAgIHRhYmxlQnVpbGRlci5pbml0X2FsdGVyX29wZXJhdGlvbnMobW9kZWxTY2hlbWEsIGRiU2NoZW1hLCBub3JtYWxpemVkTW9kZWxTY2hlbWEsIG5vcm1hbGl6ZWREQlNjaGVtYSwgKGVycjEpID0+IHtcbiAgICAgICAgICBpZiAoZXJyMSAmJiBlcnIxLm1lc3NhZ2UgPT09ICdhbHRlcl9pbXBvc3NpYmxlJykge1xuICAgICAgICAgICAgdGFibGVCdWlsZGVyLmRyb3BfcmVjcmVhdGVfdGFibGUobW9kZWxTY2hlbWEsIG5vcm1hbGl6ZWREQlNjaGVtYS5tYXRlcmlhbGl6ZWRfdmlld3MsIGFmdGVyREJDcmVhdGUpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjYWxsYmFjayhlcnIxKTtcbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0YWJsZUJ1aWxkZXIuZHJvcF9yZWNyZWF0ZV90YWJsZShtb2RlbFNjaGVtYSwgbm9ybWFsaXplZERCU2NoZW1hLm1hdGVyaWFsaXplZF92aWV3cywgYWZ0ZXJEQkNyZWF0ZSk7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChtaWdyYXRpb24gPT09ICdkcm9wJykge1xuICAgICAgdGFibGVCdWlsZGVyLmRyb3BfcmVjcmVhdGVfdGFibGUobW9kZWxTY2hlbWEsIG5vcm1hbGl6ZWREQlNjaGVtYS5tYXRlcmlhbGl6ZWRfdmlld3MsIGFmdGVyREJDcmVhdGUpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjYWxsYmFjayhidWlsZEVycm9yKCdtb2RlbC50YWJsZWNyZWF0aW9uLnNjaGVtYW1pc21hdGNoJywgdGFibGVOYW1lLCAnbWlncmF0aW9uIHN1c3BlbmRlZCwgcGxlYXNlIGFwcGx5IHRoZSBjaGFuZ2UgbWFudWFsbHknKSk7XG4gICAgfVxuICB9KTtcbn07XG5cbkJhc2VNb2RlbC5fc3luY19lc19pbmRleCA9IGZ1bmN0aW9uIGYoY2FsbGJhY2spIHtcbiAgY29uc3QgcHJvcGVydGllcyA9IHRoaXMuX3Byb3BlcnRpZXM7XG5cbiAgaWYgKHByb3BlcnRpZXMuZXNjbGllbnQgJiYgcHJvcGVydGllcy5zY2hlbWEuZXNfaW5kZXhfbWFwcGluZykge1xuICAgIGNvbnN0IGtleXNwYWNlTmFtZSA9IHByb3BlcnRpZXMua2V5c3BhY2U7XG4gICAgY29uc3QgbWFwcGluZ05hbWUgPSBwcm9wZXJ0aWVzLnRhYmxlX25hbWU7XG4gICAgY29uc3QgaW5kZXhOYW1lID0gYCR7a2V5c3BhY2VOYW1lfV8ke21hcHBpbmdOYW1lfWA7XG5cbiAgICBjb25zdCBlbGFzc2FuZHJhQnVpbGRlciA9IG5ldyBFbGFzc2FuZHJhQnVpbGRlcihwcm9wZXJ0aWVzLmVzY2xpZW50KTtcbiAgICBlbGFzc2FuZHJhQnVpbGRlci5hc3NlcnRfaW5kZXgoa2V5c3BhY2VOYW1lLCBpbmRleE5hbWUsIChlcnIpID0+IHtcbiAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgY2FsbGJhY2soZXJyKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgZWxhc3NhbmRyYUJ1aWxkZXIucHV0X21hcHBpbmcoaW5kZXhOYW1lLCBtYXBwaW5nTmFtZSwgcHJvcGVydGllcy5zY2hlbWEuZXNfaW5kZXhfbWFwcGluZywgY2FsbGJhY2spO1xuICAgIH0pO1xuICAgIHJldHVybjtcbiAgfVxuICBjYWxsYmFjaygpO1xufTtcblxuQmFzZU1vZGVsLl9zeW5jX2dyYXBoID0gZnVuY3Rpb24gZihjYWxsYmFjaykge1xuICBjb25zdCBwcm9wZXJ0aWVzID0gdGhpcy5fcHJvcGVydGllcztcblxuICBpZiAocHJvcGVydGllcy5ncmVtbGluX2NsaWVudCAmJiBwcm9wZXJ0aWVzLnNjaGVtYS5ncmFwaF9tYXBwaW5nKSB7XG4gICAgY29uc3QgZ3JhcGhOYW1lID0gYCR7cHJvcGVydGllcy5rZXlzcGFjZX1fZ3JhcGhgO1xuICAgIGNvbnN0IG1hcHBpbmdOYW1lID0gcHJvcGVydGllcy50YWJsZV9uYW1lO1xuXG4gICAgY29uc3QgZ3JhcGhCdWlsZGVyID0gbmV3IEphbnVzR3JhcGhCdWlsZGVyKHByb3BlcnRpZXMuZ3JlbWxpbl9jbGllbnQpO1xuICAgIGdyYXBoQnVpbGRlci5hc3NlcnRfZ3JhcGgoZ3JhcGhOYW1lLCAoZXJyKSA9PiB7XG4gICAgICBpZiAoZXJyKSB7XG4gICAgICAgIGNhbGxiYWNrKGVycik7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGdyYXBoQnVpbGRlci5wdXRfbWFwcGluZyhncmFwaE5hbWUsIG1hcHBpbmdOYW1lLCBwcm9wZXJ0aWVzLnNjaGVtYS5ncmFwaF9tYXBwaW5nLCBjYWxsYmFjayk7XG4gICAgfSk7XG4gICAgcmV0dXJuO1xuICB9XG4gIGNhbGxiYWNrKCk7XG59O1xuXG5CYXNlTW9kZWwuX2V4ZWN1dGVfdGFibGVfcXVlcnkgPSBmdW5jdGlvbiBmKHF1ZXJ5LCBwYXJhbXMsIG9wdGlvbnMsIGNhbGxiYWNrKSB7XG4gIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAzKSB7XG4gICAgY2FsbGJhY2sgPSBvcHRpb25zO1xuICAgIG9wdGlvbnMgPSB7fTtcbiAgfVxuXG4gIGNvbnN0IGRlZmF1bHRzID0ge1xuICAgIHByZXBhcmU6IHRydWUsXG4gIH07XG5cbiAgb3B0aW9ucyA9IF8uZGVmYXVsdHNEZWVwKG9wdGlvbnMsIGRlZmF1bHRzKTtcblxuICBjb25zdCBkb0V4ZWN1dGVRdWVyeSA9IGZ1bmN0aW9uIGYxKGRvcXVlcnksIGRvY2FsbGJhY2spIHtcbiAgICB0aGlzLmV4ZWN1dGVfcXVlcnkoZG9xdWVyeSwgcGFyYW1zLCBvcHRpb25zLCBkb2NhbGxiYWNrKTtcbiAgfS5iaW5kKHRoaXMsIHF1ZXJ5KTtcblxuICBpZiAodGhpcy5pc190YWJsZV9yZWFkeSgpKSB7XG4gICAgZG9FeGVjdXRlUXVlcnkoY2FsbGJhY2spO1xuICB9IGVsc2Uge1xuICAgIHRoaXMuaW5pdCgoZXJyKSA9PiB7XG4gICAgICBpZiAoZXJyKSB7XG4gICAgICAgIGNhbGxiYWNrKGVycik7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGRvRXhlY3V0ZVF1ZXJ5KGNhbGxiYWNrKTtcbiAgICB9KTtcbiAgfVxufTtcblxuQmFzZU1vZGVsLmdldF9maW5kX3F1ZXJ5ID0gZnVuY3Rpb24gZihxdWVyeU9iamVjdCwgb3B0aW9ucykge1xuICBjb25zdCBvcmRlcmJ5Q2xhdXNlID0gcGFyc2VyLmdldF9vcmRlcmJ5X2NsYXVzZShxdWVyeU9iamVjdCk7XG4gIGNvbnN0IGxpbWl0Q2xhdXNlID0gcGFyc2VyLmdldF9saW1pdF9jbGF1c2UocXVlcnlPYmplY3QpO1xuICBjb25zdCB3aGVyZUNsYXVzZSA9IHBhcnNlci5nZXRfd2hlcmVfY2xhdXNlKHRoaXMuX3Byb3BlcnRpZXMuc2NoZW1hLCBxdWVyeU9iamVjdCk7XG4gIGNvbnN0IHNlbGVjdENsYXVzZSA9IHBhcnNlci5nZXRfc2VsZWN0X2NsYXVzZShvcHRpb25zKTtcblxuICBsZXQgcXVlcnkgPSB1dGlsLmZvcm1hdChcbiAgICAnU0VMRUNUICVzICVzIEZST00gXCIlc1wiICVzICVzICVzJyxcbiAgICAob3B0aW9ucy5kaXN0aW5jdCA/ICdESVNUSU5DVCcgOiAnJyksXG4gICAgc2VsZWN0Q2xhdXNlLFxuICAgIG9wdGlvbnMubWF0ZXJpYWxpemVkX3ZpZXcgPyBvcHRpb25zLm1hdGVyaWFsaXplZF92aWV3IDogdGhpcy5fcHJvcGVydGllcy50YWJsZV9uYW1lLFxuICAgIHdoZXJlQ2xhdXNlLnF1ZXJ5LFxuICAgIG9yZGVyYnlDbGF1c2UsXG4gICAgbGltaXRDbGF1c2UsXG4gICk7XG5cbiAgaWYgKG9wdGlvbnMuYWxsb3dfZmlsdGVyaW5nKSBxdWVyeSArPSAnIEFMTE9XIEZJTFRFUklORzsnO1xuICBlbHNlIHF1ZXJ5ICs9ICc7JztcblxuICByZXR1cm4geyBxdWVyeSwgcGFyYW1zOiB3aGVyZUNsYXVzZS5wYXJhbXMgfTtcbn07XG5cbkJhc2VNb2RlbC5nZXRfdGFibGVfbmFtZSA9IGZ1bmN0aW9uIGYoKSB7XG4gIHJldHVybiB0aGlzLl9wcm9wZXJ0aWVzLnRhYmxlX25hbWU7XG59O1xuXG5CYXNlTW9kZWwuZ2V0X2tleXNwYWNlX25hbWUgPSBmdW5jdGlvbiBmKCkge1xuICByZXR1cm4gdGhpcy5fcHJvcGVydGllcy5rZXlzcGFjZTtcbn07XG5cbkJhc2VNb2RlbC5pc190YWJsZV9yZWFkeSA9IGZ1bmN0aW9uIGYoKSB7XG4gIHJldHVybiB0aGlzLl9yZWFkeSA9PT0gdHJ1ZTtcbn07XG5cbkJhc2VNb2RlbC5pbml0ID0gZnVuY3Rpb24gZihvcHRpb25zLCBjYWxsYmFjaykge1xuICBpZiAoIWNhbGxiYWNrKSB7XG4gICAgY2FsbGJhY2sgPSBvcHRpb25zO1xuICAgIG9wdGlvbnMgPSB1bmRlZmluZWQ7XG4gIH1cblxuICB0aGlzLl9yZWFkeSA9IHRydWU7XG4gIGNhbGxiYWNrKCk7XG59O1xuXG5CYXNlTW9kZWwuc3luY0RCID0gZnVuY3Rpb24gZihjYWxsYmFjaykge1xuICB0aGlzLl9zeW5jX21vZGVsX2RlZmluaXRpb24oKGVyciwgcmVzdWx0KSA9PiB7XG4gICAgaWYgKGVycikge1xuICAgICAgY2FsbGJhY2soZXJyKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLl9zeW5jX2VzX2luZGV4KChlcnIxKSA9PiB7XG4gICAgICBpZiAoZXJyMSkge1xuICAgICAgICBjYWxsYmFjayhlcnIxKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICB0aGlzLl9zeW5jX2dyYXBoKChlcnIyKSA9PiB7XG4gICAgICAgIGlmIChlcnIyKSB7XG4gICAgICAgICAgY2FsbGJhY2soZXJyMik7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5fcmVhZHkgPSB0cnVlO1xuICAgICAgICBjYWxsYmFjayhudWxsLCByZXN1bHQpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xufTtcblxuQmFzZU1vZGVsLmdldF9jcWxfY2xpZW50ID0gZnVuY3Rpb24gZihjYWxsYmFjaykge1xuICB0aGlzLl9kcml2ZXIuZW5zdXJlX2luaXQoKGVycikgPT4ge1xuICAgIGlmIChlcnIpIHtcbiAgICAgIGNhbGxiYWNrKGVycik7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNhbGxiYWNrKG51bGwsIHRoaXMuX3Byb3BlcnRpZXMuY3FsKTtcbiAgfSk7XG59O1xuXG5CYXNlTW9kZWwuZ2V0X2VzX2NsaWVudCA9IGZ1bmN0aW9uIGYoKSB7XG4gIGlmICghdGhpcy5fcHJvcGVydGllcy5lc2NsaWVudCkge1xuICAgIHRocm93IChuZXcgRXJyb3IoJ1RvIHVzZSBlbGFzc2FuZHJhIGZlYXR1cmVzLCBzZXQgYG1hbmFnZUVTSW5kZXhgIHRvIHRydWUgaW4gb3JtT3B0aW9ucycpKTtcbiAgfVxuICByZXR1cm4gdGhpcy5fcHJvcGVydGllcy5lc2NsaWVudDtcbn07XG5cbkJhc2VNb2RlbC5nZXRfZ3JlbWxpbl9jbGllbnQgPSBmdW5jdGlvbiBmKCkge1xuICBpZiAoIXRoaXMuX3Byb3BlcnRpZXMuZ3JlbWxpbl9jbGllbnQpIHtcbiAgICB0aHJvdyAobmV3IEVycm9yKCdUbyB1c2UgamFudXMgZ3JhcGggZmVhdHVyZXMsIHNldCBgbWFuYWdlR3JhcGhzYCB0byB0cnVlIGluIG9ybU9wdGlvbnMnKSk7XG4gIH1cbiAgcmV0dXJuIHRoaXMuX3Byb3BlcnRpZXMuZ3JlbWxpbl9jbGllbnQ7XG59O1xuXG5CYXNlTW9kZWwuZXhlY3V0ZV9xdWVyeSA9IGZ1bmN0aW9uIGYoLi4uYXJncykge1xuICB0aGlzLl9kcml2ZXIuZXhlY3V0ZV9xdWVyeSguLi5hcmdzKTtcbn07XG5cbkJhc2VNb2RlbC5leGVjdXRlX2JhdGNoID0gZnVuY3Rpb24gZiguLi5hcmdzKSB7XG4gIHRoaXMuX2RyaXZlci5leGVjdXRlX2JhdGNoKC4uLmFyZ3MpO1xufTtcblxuQmFzZU1vZGVsLmV4ZWN1dGVfZWFjaFJvdyA9IGZ1bmN0aW9uIGYoLi4uYXJncykge1xuICB0aGlzLl9kcml2ZXIuZXhlY3V0ZV9lYWNoUm93KC4uLmFyZ3MpO1xufTtcblxuQmFzZU1vZGVsLl9leGVjdXRlX3RhYmxlX2VhY2hSb3cgPSBmdW5jdGlvbiBmKHF1ZXJ5LCBwYXJhbXMsIG9wdGlvbnMsIG9uUmVhZGFibGUsIGNhbGxiYWNrKSB7XG4gIGlmICh0aGlzLmlzX3RhYmxlX3JlYWR5KCkpIHtcbiAgICB0aGlzLmV4ZWN1dGVfZWFjaFJvdyhxdWVyeSwgcGFyYW1zLCBvcHRpb25zLCBvblJlYWRhYmxlLCBjYWxsYmFjayk7XG4gIH0gZWxzZSB7XG4gICAgdGhpcy5pbml0KChlcnIpID0+IHtcbiAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgY2FsbGJhY2soZXJyKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgdGhpcy5leGVjdXRlX2VhY2hSb3cocXVlcnksIHBhcmFtcywgb3B0aW9ucywgb25SZWFkYWJsZSwgY2FsbGJhY2spO1xuICAgIH0pO1xuICB9XG59O1xuXG5CYXNlTW9kZWwuZWFjaFJvdyA9IGZ1bmN0aW9uIGYocXVlcnlPYmplY3QsIG9wdGlvbnMsIG9uUmVhZGFibGUsIGNhbGxiYWNrKSB7XG4gIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAzKSB7XG4gICAgY29uc3QgY2IgPSBvblJlYWRhYmxlO1xuICAgIG9uUmVhZGFibGUgPSBvcHRpb25zO1xuICAgIGNhbGxiYWNrID0gY2I7XG4gICAgb3B0aW9ucyA9IHt9O1xuICB9XG4gIGlmICh0eXBlb2Ygb25SZWFkYWJsZSAhPT0gJ2Z1bmN0aW9uJykge1xuICAgIHRocm93IChidWlsZEVycm9yKCdtb2RlbC5maW5kLmVhY2hyb3dlcnJvcicsICdubyB2YWxpZCBvblJlYWRhYmxlIGZ1bmN0aW9uIHdhcyBwcm92aWRlZCcpKTtcbiAgfVxuICBpZiAodHlwZW9mIGNhbGxiYWNrICE9PSAnZnVuY3Rpb24nKSB7XG4gICAgdGhyb3cgKGJ1aWxkRXJyb3IoJ21vZGVsLmZpbmQuY2JlcnJvcicpKTtcbiAgfVxuXG4gIGNvbnN0IGRlZmF1bHRzID0ge1xuICAgIHJhdzogZmFsc2UsXG4gICAgcHJlcGFyZTogdHJ1ZSxcbiAgfTtcblxuICBvcHRpb25zID0gXy5kZWZhdWx0c0RlZXAob3B0aW9ucywgZGVmYXVsdHMpO1xuXG4gIG9wdGlvbnMucmV0dXJuX3F1ZXJ5ID0gdHJ1ZTtcbiAgY29uc3Qgc2VsZWN0UXVlcnkgPSB0aGlzLmZpbmQocXVlcnlPYmplY3QsIG9wdGlvbnMpO1xuXG4gIGNvbnN0IHF1ZXJ5T3B0aW9ucyA9IG5vcm1hbGl6ZXIubm9ybWFsaXplX3F1ZXJ5X29wdGlvbihvcHRpb25zKTtcblxuICB0aGlzLl9leGVjdXRlX3RhYmxlX2VhY2hSb3coc2VsZWN0UXVlcnkucXVlcnksIHNlbGVjdFF1ZXJ5LnBhcmFtcywgcXVlcnlPcHRpb25zLCAobiwgcm93KSA9PiB7XG4gICAgaWYgKCFvcHRpb25zLnJhdykge1xuICAgICAgY29uc3QgTW9kZWxDb25zdHJ1Y3RvciA9IHRoaXMuX3Byb3BlcnRpZXMuZ2V0X2NvbnN0cnVjdG9yKCk7XG4gICAgICByb3cgPSBuZXcgTW9kZWxDb25zdHJ1Y3Rvcihyb3cpO1xuICAgICAgcm93Ll9tb2RpZmllZCA9IHt9O1xuICAgIH1cbiAgICBvblJlYWRhYmxlKG4sIHJvdyk7XG4gIH0sIChlcnIsIHJlc3VsdCkgPT4ge1xuICAgIGlmIChlcnIpIHtcbiAgICAgIGNhbGxiYWNrKGJ1aWxkRXJyb3IoJ21vZGVsLmZpbmQuZGJlcnJvcicsIGVycikpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjYWxsYmFjayhlcnIsIHJlc3VsdCk7XG4gIH0pO1xufTtcblxuQmFzZU1vZGVsLmV4ZWN1dGVfc3RyZWFtID0gZnVuY3Rpb24gZiguLi5hcmdzKSB7XG4gIHRoaXMuX2RyaXZlci5leGVjdXRlX3N0cmVhbSguLi5hcmdzKTtcbn07XG5cbkJhc2VNb2RlbC5fZXhlY3V0ZV90YWJsZV9zdHJlYW0gPSBmdW5jdGlvbiBmKHF1ZXJ5LCBwYXJhbXMsIG9wdGlvbnMsIG9uUmVhZGFibGUsIGNhbGxiYWNrKSB7XG4gIGlmICh0aGlzLmlzX3RhYmxlX3JlYWR5KCkpIHtcbiAgICB0aGlzLmV4ZWN1dGVfc3RyZWFtKHF1ZXJ5LCBwYXJhbXMsIG9wdGlvbnMsIG9uUmVhZGFibGUsIGNhbGxiYWNrKTtcbiAgfSBlbHNlIHtcbiAgICB0aGlzLmluaXQoKGVycikgPT4ge1xuICAgICAgaWYgKGVycikge1xuICAgICAgICBjYWxsYmFjayhlcnIpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICB0aGlzLmV4ZWN1dGVfc3RyZWFtKHF1ZXJ5LCBwYXJhbXMsIG9wdGlvbnMsIG9uUmVhZGFibGUsIGNhbGxiYWNrKTtcbiAgICB9KTtcbiAgfVxufTtcblxuQmFzZU1vZGVsLnN0cmVhbSA9IGZ1bmN0aW9uIGYocXVlcnlPYmplY3QsIG9wdGlvbnMsIG9uUmVhZGFibGUsIGNhbGxiYWNrKSB7XG4gIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAzKSB7XG4gICAgY29uc3QgY2IgPSBvblJlYWRhYmxlO1xuICAgIG9uUmVhZGFibGUgPSBvcHRpb25zO1xuICAgIGNhbGxiYWNrID0gY2I7XG4gICAgb3B0aW9ucyA9IHt9O1xuICB9XG5cbiAgaWYgKHR5cGVvZiBvblJlYWRhYmxlICE9PSAnZnVuY3Rpb24nKSB7XG4gICAgdGhyb3cgKGJ1aWxkRXJyb3IoJ21vZGVsLmZpbmQuc3RyZWFtZXJyb3InLCAnbm8gdmFsaWQgb25SZWFkYWJsZSBmdW5jdGlvbiB3YXMgcHJvdmlkZWQnKSk7XG4gIH1cbiAgaWYgKHR5cGVvZiBjYWxsYmFjayAhPT0gJ2Z1bmN0aW9uJykge1xuICAgIHRocm93IChidWlsZEVycm9yKCdtb2RlbC5maW5kLmNiZXJyb3InKSk7XG4gIH1cblxuICBjb25zdCBkZWZhdWx0cyA9IHtcbiAgICByYXc6IGZhbHNlLFxuICAgIHByZXBhcmU6IHRydWUsXG4gIH07XG5cbiAgb3B0aW9ucyA9IF8uZGVmYXVsdHNEZWVwKG9wdGlvbnMsIGRlZmF1bHRzKTtcblxuICBvcHRpb25zLnJldHVybl9xdWVyeSA9IHRydWU7XG4gIGNvbnN0IHNlbGVjdFF1ZXJ5ID0gdGhpcy5maW5kKHF1ZXJ5T2JqZWN0LCBvcHRpb25zKTtcblxuICBjb25zdCBxdWVyeU9wdGlvbnMgPSBub3JtYWxpemVyLm5vcm1hbGl6ZV9xdWVyeV9vcHRpb24ob3B0aW9ucyk7XG5cbiAgY29uc3Qgc2VsZiA9IHRoaXM7XG5cbiAgdGhpcy5fZXhlY3V0ZV90YWJsZV9zdHJlYW0oc2VsZWN0UXVlcnkucXVlcnksIHNlbGVjdFF1ZXJ5LnBhcmFtcywgcXVlcnlPcHRpb25zLCBmdW5jdGlvbiBmMSgpIHtcbiAgICBjb25zdCByZWFkZXIgPSB0aGlzO1xuICAgIHJlYWRlci5yZWFkUm93ID0gKCkgPT4ge1xuICAgICAgY29uc3Qgcm93ID0gcmVhZGVyLnJlYWQoKTtcbiAgICAgIGlmICghcm93KSByZXR1cm4gcm93O1xuICAgICAgaWYgKCFvcHRpb25zLnJhdykge1xuICAgICAgICBjb25zdCBNb2RlbENvbnN0cnVjdG9yID0gc2VsZi5fcHJvcGVydGllcy5nZXRfY29uc3RydWN0b3IoKTtcbiAgICAgICAgY29uc3QgbyA9IG5ldyBNb2RlbENvbnN0cnVjdG9yKHJvdyk7XG4gICAgICAgIG8uX21vZGlmaWVkID0ge307XG4gICAgICAgIHJldHVybiBvO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHJvdztcbiAgICB9O1xuICAgIG9uUmVhZGFibGUocmVhZGVyKTtcbiAgfSwgKGVycikgPT4ge1xuICAgIGlmIChlcnIpIHtcbiAgICAgIGNhbGxiYWNrKGJ1aWxkRXJyb3IoJ21vZGVsLmZpbmQuZGJlcnJvcicsIGVycikpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjYWxsYmFjaygpO1xuICB9KTtcbn07XG5cbkJhc2VNb2RlbC5fZXhlY3V0ZV9ncmVtbGluX3F1ZXJ5ID0gZnVuY3Rpb24gZihzY3JpcHQsIGJpbmRpbmdzLCBjYWxsYmFjaykge1xuICBjb25zdCBncmVtbGluQ2xpZW50ID0gdGhpcy5nZXRfZ3JlbWxpbl9jbGllbnQoKTtcbiAgZ3JlbWxpbkNsaWVudC5leGVjdXRlKHNjcmlwdCwgYmluZGluZ3MsIChlcnIsIHJlc3VsdHMpID0+IHtcbiAgICBpZiAoZXJyKSB7XG4gICAgICBjYWxsYmFjayhlcnIpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjYWxsYmFjayhudWxsLCByZXN1bHRzKTtcbiAgfSk7XG59O1xuXG5CYXNlTW9kZWwuX2V4ZWN1dGVfZ3JlbWxpbl9zY3JpcHQgPSBmdW5jdGlvbiBmKHNjcmlwdCwgYmluZGluZ3MsIGNhbGxiYWNrKSB7XG4gIHRoaXMuX2V4ZWN1dGVfZ3JlbWxpbl9xdWVyeShzY3JpcHQsIGJpbmRpbmdzLCAoZXJyLCByZXN1bHRzKSA9PiB7XG4gICAgaWYgKGVycikge1xuICAgICAgY2FsbGJhY2soZXJyKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY2FsbGJhY2sobnVsbCwgcmVzdWx0c1swXSk7XG4gIH0pO1xufTtcblxuQmFzZU1vZGVsLmNyZWF0ZVZlcnRleCA9IGZ1bmN0aW9uIGYodmVydGV4UHJvcGVydGllcywgY2FsbGJhY2spIHtcbiAgY29uc3QgcHJvcGVydGllcyA9IHRoaXMuX3Byb3BlcnRpZXM7XG4gIGNvbnN0IF9fZ3JhcGhOYW1lID0gYCR7cHJvcGVydGllcy5rZXlzcGFjZX1fZ3JhcGhgO1xuICBjb25zdCBfX3ZlcnRleExhYmVsID0gcHJvcGVydGllcy50YWJsZV9uYW1lO1xuICBsZXQgc2NyaXB0ID0gYFxuICAgIGdyYXBoID0gQ29uZmlndXJlZEdyYXBoRmFjdG9yeS5vcGVuKF9fZ3JhcGhOYW1lKTtcbiAgICB2ZXJ0ZXggPSBncmFwaC5hZGRWZXJ0ZXgoX192ZXJ0ZXhMYWJlbCk7XG4gIGA7XG4gIE9iamVjdC5rZXlzKHZlcnRleFByb3BlcnRpZXMpLmZvckVhY2goKHByb3BlcnR5KSA9PiB7XG4gICAgc2NyaXB0ICs9IGB2ZXJ0ZXgucHJvcGVydHkoJyR7cHJvcGVydHl9JywgJHtwcm9wZXJ0eX0pO2A7XG4gIH0pO1xuICBzY3JpcHQgKz0gJ3ZlcnRleCc7XG4gIGNvbnN0IGJpbmRpbmdzID0gXy5kZWZhdWx0cyh2ZXJ0ZXhQcm9wZXJ0aWVzLCB7XG4gICAgX19ncmFwaE5hbWUsXG4gICAgX192ZXJ0ZXhMYWJlbCxcbiAgfSk7XG4gIHRoaXMuX2V4ZWN1dGVfZ3JlbWxpbl9zY3JpcHQoc2NyaXB0LCBiaW5kaW5ncywgY2FsbGJhY2spO1xufTtcblxuQmFzZU1vZGVsLmdldFZlcnRleCA9IGZ1bmN0aW9uIGYoX192ZXJ0ZXhJZCwgY2FsbGJhY2spIHtcbiAgY29uc3QgcHJvcGVydGllcyA9IHRoaXMuX3Byb3BlcnRpZXM7XG4gIGNvbnN0IF9fZ3JhcGhOYW1lID0gYCR7cHJvcGVydGllcy5rZXlzcGFjZX1fZ3JhcGhgO1xuICBjb25zdCBzY3JpcHQgPSBgXG4gICAgZ3JhcGggPSBDb25maWd1cmVkR3JhcGhGYWN0b3J5Lm9wZW4oX19ncmFwaE5hbWUpO1xuICAgIGcgPSBncmFwaC50cmF2ZXJzYWwoKTtcbiAgICB2ZXJ0ZXggPSBnLlYoX192ZXJ0ZXhJZCk7XG4gIGA7XG4gIGNvbnN0IGJpbmRpbmdzID0ge1xuICAgIF9fZ3JhcGhOYW1lLFxuICAgIF9fdmVydGV4SWQsXG4gIH07XG4gIHRoaXMuX2V4ZWN1dGVfZ3JlbWxpbl9zY3JpcHQoc2NyaXB0LCBiaW5kaW5ncywgY2FsbGJhY2spO1xufTtcblxuQmFzZU1vZGVsLnVwZGF0ZVZlcnRleCA9IGZ1bmN0aW9uIGYoX192ZXJ0ZXhJZCwgdmVydGV4UHJvcGVydGllcywgY2FsbGJhY2spIHtcbiAgY29uc3QgcHJvcGVydGllcyA9IHRoaXMuX3Byb3BlcnRpZXM7XG4gIGNvbnN0IF9fZ3JhcGhOYW1lID0gYCR7cHJvcGVydGllcy5rZXlzcGFjZX1fZ3JhcGhgO1xuICBsZXQgc2NyaXB0ID0gYFxuICAgIGdyYXBoID0gQ29uZmlndXJlZEdyYXBoRmFjdG9yeS5vcGVuKF9fZ3JhcGhOYW1lKTtcbiAgICBnID0gZ3JhcGgudHJhdmVyc2FsKCk7XG4gICAgdmVydGV4ID0gZy5WKF9fdmVydGV4SWQpO1xuICBgO1xuICBPYmplY3Qua2V5cyh2ZXJ0ZXhQcm9wZXJ0aWVzKS5mb3JFYWNoKChwcm9wZXJ0eSkgPT4ge1xuICAgIHNjcmlwdCArPSBgdmVydGV4LnByb3BlcnR5KCcke3Byb3BlcnR5fScsICR7cHJvcGVydHl9KTtgO1xuICB9KTtcbiAgc2NyaXB0ICs9ICd2ZXJ0ZXgnO1xuICBjb25zdCBiaW5kaW5ncyA9IF8uZGVmYXVsdHModmVydGV4UHJvcGVydGllcywge1xuICAgIF9fZ3JhcGhOYW1lLFxuICAgIF9fdmVydGV4SWQsXG4gIH0pO1xuICB0aGlzLl9leGVjdXRlX2dyZW1saW5fc2NyaXB0KHNjcmlwdCwgYmluZGluZ3MsIGNhbGxiYWNrKTtcbn07XG5cbkJhc2VNb2RlbC5kZWxldGVWZXJ0ZXggPSBmdW5jdGlvbiBmKF9fdmVydGV4SWQsIGNhbGxiYWNrKSB7XG4gIGNvbnN0IHByb3BlcnRpZXMgPSB0aGlzLl9wcm9wZXJ0aWVzO1xuICBjb25zdCBfX2dyYXBoTmFtZSA9IGAke3Byb3BlcnRpZXMua2V5c3BhY2V9X2dyYXBoYDtcbiAgY29uc3Qgc2NyaXB0ID0gYFxuICAgIGdyYXBoID0gQ29uZmlndXJlZEdyYXBoRmFjdG9yeS5vcGVuKF9fZ3JhcGhOYW1lKTtcbiAgICBnID0gZ3JhcGgudHJhdmVyc2FsKCk7XG4gICAgdmVydGV4ID0gZy5WKF9fdmVydGV4SWQpO1xuICAgIHZlcnRleC5kcm9wKCk7XG4gIGA7XG4gIGNvbnN0IGJpbmRpbmdzID0ge1xuICAgIF9fZ3JhcGhOYW1lLFxuICAgIF9fdmVydGV4SWQsXG4gIH07XG4gIHRoaXMuX2V4ZWN1dGVfZ3JlbWxpbl9zY3JpcHQoc2NyaXB0LCBiaW5kaW5ncywgY2FsbGJhY2spO1xufTtcblxuQmFzZU1vZGVsLmNyZWF0ZUVkZ2UgPSBmdW5jdGlvbiBmKF9fZWRnZUxhYmVsLCBfX2Zyb21WZXJ0ZXhJZCwgX190b1ZlcnRleElkLCBlZGdlUHJvcGVydGllcywgY2FsbGJhY2spIHtcbiAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDQgJiYgdHlwZW9mIGVkZ2VQcm9wZXJ0aWVzID09PSAnZnVuY3Rpb24nKSB7XG4gICAgY2FsbGJhY2sgPSBlZGdlUHJvcGVydGllcztcbiAgICBlZGdlUHJvcGVydGllcyA9IHt9O1xuICB9XG4gIGNvbnN0IHByb3BlcnRpZXMgPSB0aGlzLl9wcm9wZXJ0aWVzO1xuICBjb25zdCBfX2dyYXBoTmFtZSA9IGAke3Byb3BlcnRpZXMua2V5c3BhY2V9X2dyYXBoYDtcbiAgbGV0IHNjcmlwdCA9IGBcbiAgICBncmFwaCA9IENvbmZpZ3VyZWRHcmFwaEZhY3Rvcnkub3BlbihfX2dyYXBoTmFtZSk7XG4gICAgZyA9IGdyYXBoLnRyYXZlcnNhbCgpO1xuICAgIGZyb21WZXJ0ZXggPSBnLlYoX19mcm9tVmVydGV4SWQpLm5leHQoKTtcbiAgICB0b1ZlcnRleCA9IGcuVihfX3RvVmVydGV4SWQpLm5leHQoKTtcbiAgICBlZGdlID0gZnJvbVZlcnRleC5hZGRFZGdlKF9fZWRnZUxhYmVsLCB0b1ZlcnRleCk7XG4gIGA7XG4gIE9iamVjdC5rZXlzKGVkZ2VQcm9wZXJ0aWVzKS5mb3JFYWNoKChwcm9wZXJ0eSkgPT4ge1xuICAgIHNjcmlwdCArPSBgZWRnZS5wcm9wZXJ0eSgnJHtwcm9wZXJ0eX0nLCAke3Byb3BlcnR5fSk7YDtcbiAgfSk7XG4gIHNjcmlwdCArPSAnZWRnZSc7XG4gIGNvbnN0IGJpbmRpbmdzID0gXy5kZWZhdWx0cyhlZGdlUHJvcGVydGllcywge1xuICAgIF9fZ3JhcGhOYW1lLFxuICAgIF9fZnJvbVZlcnRleElkLFxuICAgIF9fdG9WZXJ0ZXhJZCxcbiAgICBfX2VkZ2VMYWJlbCxcbiAgfSk7XG4gIHRoaXMuX2V4ZWN1dGVfZ3JlbWxpbl9zY3JpcHQoc2NyaXB0LCBiaW5kaW5ncywgY2FsbGJhY2spO1xufTtcblxuQmFzZU1vZGVsLmdldEVkZ2UgPSBmdW5jdGlvbiBmKF9fZWRnZUlkLCBjYWxsYmFjaykge1xuICBjb25zdCBwcm9wZXJ0aWVzID0gdGhpcy5fcHJvcGVydGllcztcbiAgY29uc3QgX19ncmFwaE5hbWUgPSBgJHtwcm9wZXJ0aWVzLmtleXNwYWNlfV9ncmFwaGA7XG4gIGNvbnN0IHNjcmlwdCA9IGBcbiAgICBncmFwaCA9IENvbmZpZ3VyZWRHcmFwaEZhY3Rvcnkub3BlbihfX2dyYXBoTmFtZSk7XG4gICAgZyA9IGdyYXBoLnRyYXZlcnNhbCgpO1xuICAgIGVkZ2UgPSBnLkUoX19lZGdlSWQpO1xuICBgO1xuICBjb25zdCBiaW5kaW5ncyA9IHtcbiAgICBfX2dyYXBoTmFtZSxcbiAgICBfX2VkZ2VJZCxcbiAgfTtcbiAgdGhpcy5fZXhlY3V0ZV9ncmVtbGluX3NjcmlwdChzY3JpcHQsIGJpbmRpbmdzLCBjYWxsYmFjayk7XG59O1xuXG5CYXNlTW9kZWwudXBkYXRlRWRnZSA9IGZ1bmN0aW9uIGYoX19lZGdlSWQsIGVkZ2VQcm9wZXJ0aWVzLCBjYWxsYmFjaykge1xuICBjb25zdCBwcm9wZXJ0aWVzID0gdGhpcy5fcHJvcGVydGllcztcbiAgY29uc3QgX19ncmFwaE5hbWUgPSBgJHtwcm9wZXJ0aWVzLmtleXNwYWNlfV9ncmFwaGA7XG4gIGxldCBzY3JpcHQgPSBgXG4gICAgZ3JhcGggPSBDb25maWd1cmVkR3JhcGhGYWN0b3J5Lm9wZW4oX19ncmFwaE5hbWUpO1xuICAgIGcgPSBncmFwaC50cmF2ZXJzYWwoKTtcbiAgICBlZGdlID0gZy5FKF9fZWRnZUlkKTtcbiAgYDtcbiAgT2JqZWN0LmtleXMoZWRnZVByb3BlcnRpZXMpLmZvckVhY2goKHByb3BlcnR5KSA9PiB7XG4gICAgc2NyaXB0ICs9IGBlZGdlLnByb3BlcnR5KCcke3Byb3BlcnR5fScsICR7cHJvcGVydHl9KTtgO1xuICB9KTtcbiAgc2NyaXB0ICs9ICdlZGdlJztcbiAgY29uc3QgYmluZGluZ3MgPSBfLmRlZmF1bHRzKGVkZ2VQcm9wZXJ0aWVzLCB7XG4gICAgX19ncmFwaE5hbWUsXG4gICAgX19lZGdlSWQsXG4gIH0pO1xuICB0aGlzLl9leGVjdXRlX2dyZW1saW5fc2NyaXB0KHNjcmlwdCwgYmluZGluZ3MsIGNhbGxiYWNrKTtcbn07XG5cbkJhc2VNb2RlbC5kZWxldGVFZGdlID0gZnVuY3Rpb24gZihfX2VkZ2VJZCwgY2FsbGJhY2spIHtcbiAgY29uc3QgcHJvcGVydGllcyA9IHRoaXMuX3Byb3BlcnRpZXM7XG4gIGNvbnN0IF9fZ3JhcGhOYW1lID0gYCR7cHJvcGVydGllcy5rZXlzcGFjZX1fZ3JhcGhgO1xuICBjb25zdCBzY3JpcHQgPSBgXG4gICAgZ3JhcGggPSBDb25maWd1cmVkR3JhcGhGYWN0b3J5Lm9wZW4oX19ncmFwaE5hbWUpO1xuICAgIGcgPSBncmFwaC50cmF2ZXJzYWwoKTtcbiAgICBlZGdlID0gZy5FKF9fZWRnZUlkKTtcbiAgICBlZGdlLmRyb3AoKTtcbiAgYDtcbiAgY29uc3QgYmluZGluZ3MgPSB7XG4gICAgX19ncmFwaE5hbWUsXG4gICAgX19lZGdlSWQsXG4gIH07XG4gIHRoaXMuX2V4ZWN1dGVfZ3JlbWxpbl9zY3JpcHQoc2NyaXB0LCBiaW5kaW5ncywgY2FsbGJhY2spO1xufTtcblxuQmFzZU1vZGVsLmdyYXBoUXVlcnkgPSBmdW5jdGlvbiBmKHF1ZXJ5LCBwYXJhbXMsIGNhbGxiYWNrKSB7XG4gIGNvbnN0IHByb3BlcnRpZXMgPSB0aGlzLl9wcm9wZXJ0aWVzO1xuICBjb25zdCBfX2dyYXBoTmFtZSA9IGAke3Byb3BlcnRpZXMua2V5c3BhY2V9X2dyYXBoYDtcbiAgY29uc3QgX192ZXJ0ZXhMYWJlbCA9IHByb3BlcnRpZXMudGFibGVfbmFtZTtcbiAgbGV0IHNjcmlwdCA9IGBcbiAgICBncmFwaCA9IENvbmZpZ3VyZWRHcmFwaEZhY3Rvcnkub3BlbihfX2dyYXBoTmFtZSk7XG4gICAgZyA9IGdyYXBoLnRyYXZlcnNhbCgpO1xuICAgIHZlcnRpY2VzID0gZy5WKCkuaGFzTGFiZWwoX192ZXJ0ZXhMYWJlbCk7XG4gIGA7XG4gIHNjcmlwdCArPSBxdWVyeTtcbiAgY29uc3QgYmluZGluZ3MgPSBfLmRlZmF1bHRzKHBhcmFtcywge1xuICAgIF9fZ3JhcGhOYW1lLFxuICAgIF9fdmVydGV4TGFiZWwsXG4gIH0pO1xuICB0aGlzLl9leGVjdXRlX2dyZW1saW5fcXVlcnkoc2NyaXB0LCBiaW5kaW5ncywgY2FsbGJhY2spO1xufTtcblxuQmFzZU1vZGVsLnNlYXJjaCA9IGZ1bmN0aW9uIGYocXVlcnlPYmplY3QsIGNhbGxiYWNrKSB7XG4gIGNvbnN0IGVzQ2xpZW50ID0gdGhpcy5nZXRfZXNfY2xpZW50KCk7XG4gIGNvbnN0IGluZGV4TmFtZSA9IGAke3RoaXMuX3Byb3BlcnRpZXMua2V5c3BhY2V9XyR7dGhpcy5fcHJvcGVydGllcy50YWJsZV9uYW1lfWA7XG5cbiAgY29uc3QgcXVlcnkgPSBfLmRlZmF1bHRzKHF1ZXJ5T2JqZWN0LCB7XG4gICAgaW5kZXg6IGluZGV4TmFtZSxcbiAgICB0eXBlOiB0aGlzLl9wcm9wZXJ0aWVzLnRhYmxlX25hbWUsXG4gIH0pO1xuICBlc0NsaWVudC5zZWFyY2gocXVlcnksIChlcnIsIHJlc3BvbnNlKSA9PiB7XG4gICAgaWYgKGVycikge1xuICAgICAgY2FsbGJhY2soZXJyKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY2FsbGJhY2sobnVsbCwgcmVzcG9uc2UpO1xuICB9KTtcbn07XG5cbkJhc2VNb2RlbC5maW5kID0gZnVuY3Rpb24gZihxdWVyeU9iamVjdCwgb3B0aW9ucywgY2FsbGJhY2spIHtcbiAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDIgJiYgdHlwZW9mIG9wdGlvbnMgPT09ICdmdW5jdGlvbicpIHtcbiAgICBjYWxsYmFjayA9IG9wdGlvbnM7XG4gICAgb3B0aW9ucyA9IHt9O1xuICB9XG4gIGlmICh0eXBlb2YgY2FsbGJhY2sgIT09ICdmdW5jdGlvbicgJiYgIW9wdGlvbnMucmV0dXJuX3F1ZXJ5KSB7XG4gICAgdGhyb3cgKGJ1aWxkRXJyb3IoJ21vZGVsLmZpbmQuY2JlcnJvcicpKTtcbiAgfVxuXG4gIGNvbnN0IGRlZmF1bHRzID0ge1xuICAgIHJhdzogZmFsc2UsXG4gICAgcHJlcGFyZTogdHJ1ZSxcbiAgfTtcblxuICBvcHRpb25zID0gXy5kZWZhdWx0c0RlZXAob3B0aW9ucywgZGVmYXVsdHMpO1xuXG4gIC8vIHNldCByYXcgdHJ1ZSBpZiBzZWxlY3QgaXMgdXNlZCxcbiAgLy8gYmVjYXVzZSBjYXN0aW5nIHRvIG1vZGVsIGluc3RhbmNlcyBtYXkgbGVhZCB0byBwcm9ibGVtc1xuICBpZiAob3B0aW9ucy5zZWxlY3QpIG9wdGlvbnMucmF3ID0gdHJ1ZTtcblxuICBsZXQgcXVlcnlQYXJhbXMgPSBbXTtcblxuICBsZXQgcXVlcnk7XG4gIHRyeSB7XG4gICAgY29uc3QgZmluZFF1ZXJ5ID0gdGhpcy5nZXRfZmluZF9xdWVyeShxdWVyeU9iamVjdCwgb3B0aW9ucyk7XG4gICAgcXVlcnkgPSBmaW5kUXVlcnkucXVlcnk7XG4gICAgcXVlcnlQYXJhbXMgPSBxdWVyeVBhcmFtcy5jb25jYXQoZmluZFF1ZXJ5LnBhcmFtcyk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBwYXJzZXIuY2FsbGJhY2tfb3JfdGhyb3coZSwgY2FsbGJhY2spO1xuICAgIHJldHVybiB7fTtcbiAgfVxuXG4gIGlmIChvcHRpb25zLnJldHVybl9xdWVyeSkge1xuICAgIHJldHVybiB7IHF1ZXJ5LCBwYXJhbXM6IHF1ZXJ5UGFyYW1zIH07XG4gIH1cblxuICBjb25zdCBxdWVyeU9wdGlvbnMgPSBub3JtYWxpemVyLm5vcm1hbGl6ZV9xdWVyeV9vcHRpb24ob3B0aW9ucyk7XG5cbiAgdGhpcy5fZXhlY3V0ZV90YWJsZV9xdWVyeShxdWVyeSwgcXVlcnlQYXJhbXMsIHF1ZXJ5T3B0aW9ucywgKGVyciwgcmVzdWx0cykgPT4ge1xuICAgIGlmIChlcnIpIHtcbiAgICAgIGNhbGxiYWNrKGJ1aWxkRXJyb3IoJ21vZGVsLmZpbmQuZGJlcnJvcicsIGVycikpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoIW9wdGlvbnMucmF3KSB7XG4gICAgICBjb25zdCBNb2RlbENvbnN0cnVjdG9yID0gdGhpcy5fcHJvcGVydGllcy5nZXRfY29uc3RydWN0b3IoKTtcbiAgICAgIHJlc3VsdHMgPSByZXN1bHRzLnJvd3MubWFwKChyZXMpID0+IHtcbiAgICAgICAgZGVsZXRlIChyZXMuY29sdW1ucyk7XG4gICAgICAgIGNvbnN0IG8gPSBuZXcgTW9kZWxDb25zdHJ1Y3RvcihyZXMpO1xuICAgICAgICBvLl9tb2RpZmllZCA9IHt9O1xuICAgICAgICByZXR1cm4gbztcbiAgICAgIH0pO1xuICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdWx0cyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJlc3VsdHMgPSByZXN1bHRzLnJvd3MubWFwKChyZXMpID0+IHtcbiAgICAgICAgZGVsZXRlIChyZXMuY29sdW1ucyk7XG4gICAgICAgIHJldHVybiByZXM7XG4gICAgICB9KTtcbiAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3VsdHMpO1xuICAgIH1cbiAgfSk7XG5cbiAgcmV0dXJuIHt9O1xufTtcblxuQmFzZU1vZGVsLmZpbmRPbmUgPSBmdW5jdGlvbiBmKHF1ZXJ5T2JqZWN0LCBvcHRpb25zLCBjYWxsYmFjaykge1xuICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMiAmJiB0eXBlb2Ygb3B0aW9ucyA9PT0gJ2Z1bmN0aW9uJykge1xuICAgIGNhbGxiYWNrID0gb3B0aW9ucztcbiAgICBvcHRpb25zID0ge307XG4gIH1cbiAgaWYgKHR5cGVvZiBjYWxsYmFjayAhPT0gJ2Z1bmN0aW9uJyAmJiAhb3B0aW9ucy5yZXR1cm5fcXVlcnkpIHtcbiAgICB0aHJvdyAoYnVpbGRFcnJvcignbW9kZWwuZmluZC5jYmVycm9yJykpO1xuICB9XG5cbiAgcXVlcnlPYmplY3QuJGxpbWl0ID0gMTtcblxuICByZXR1cm4gdGhpcy5maW5kKHF1ZXJ5T2JqZWN0LCBvcHRpb25zLCAoZXJyLCByZXN1bHRzKSA9PiB7XG4gICAgaWYgKGVycikge1xuICAgICAgY2FsbGJhY2soZXJyKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKHJlc3VsdHMubGVuZ3RoID4gMCkge1xuICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdWx0c1swXSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNhbGxiYWNrKCk7XG4gIH0pO1xufTtcblxuQmFzZU1vZGVsLnVwZGF0ZSA9IGZ1bmN0aW9uIGYocXVlcnlPYmplY3QsIHVwZGF0ZVZhbHVlcywgb3B0aW9ucywgY2FsbGJhY2spIHtcbiAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDMgJiYgdHlwZW9mIG9wdGlvbnMgPT09ICdmdW5jdGlvbicpIHtcbiAgICBjYWxsYmFjayA9IG9wdGlvbnM7XG4gICAgb3B0aW9ucyA9IHt9O1xuICB9XG5cbiAgY29uc3Qgc2NoZW1hID0gdGhpcy5fcHJvcGVydGllcy5zY2hlbWE7XG5cbiAgY29uc3QgZGVmYXVsdHMgPSB7XG4gICAgcHJlcGFyZTogdHJ1ZSxcbiAgfTtcblxuICBvcHRpb25zID0gXy5kZWZhdWx0c0RlZXAob3B0aW9ucywgZGVmYXVsdHMpO1xuXG4gIGlmICh0eXBlb2Ygc2NoZW1hLmJlZm9yZV91cGRhdGUgPT09ICdmdW5jdGlvbicgJiYgc2NoZW1hLmJlZm9yZV91cGRhdGUocXVlcnlPYmplY3QsIHVwZGF0ZVZhbHVlcywgb3B0aW9ucykgPT09IGZhbHNlKSB7XG4gICAgcGFyc2VyLmNhbGxiYWNrX29yX3Rocm93KGJ1aWxkRXJyb3IoJ21vZGVsLnVwZGF0ZS5iZWZvcmUuZXJyb3InKSwgY2FsbGJhY2spO1xuICAgIHJldHVybiB7fTtcbiAgfVxuXG4gIGNvbnN0IHsgdXBkYXRlQ2xhdXNlcywgcXVlcnlQYXJhbXMsIGVycm9ySGFwcGVuZWQgfSA9IHBhcnNlci5nZXRfdXBkYXRlX3ZhbHVlX2V4cHJlc3Npb24oXG4gICAgdGhpcyxcbiAgICBzY2hlbWEsXG4gICAgdXBkYXRlVmFsdWVzLFxuICAgIGNhbGxiYWNrLFxuICApO1xuXG4gIGlmIChlcnJvckhhcHBlbmVkKSByZXR1cm4ge307XG5cbiAgbGV0IHF1ZXJ5ID0gJ1VQREFURSBcIiVzXCInO1xuICBsZXQgd2hlcmUgPSAnJztcbiAgbGV0IGZpbmFsUGFyYW1zID0gcXVlcnlQYXJhbXM7XG4gIGlmIChvcHRpb25zLnR0bCkgcXVlcnkgKz0gdXRpbC5mb3JtYXQoJyBVU0lORyBUVEwgJXMnLCBvcHRpb25zLnR0bCk7XG4gIHF1ZXJ5ICs9ICcgU0VUICVzICVzJztcbiAgdHJ5IHtcbiAgICBjb25zdCB3aGVyZUNsYXVzZSA9IHBhcnNlci5nZXRfd2hlcmVfY2xhdXNlKHNjaGVtYSwgcXVlcnlPYmplY3QpO1xuICAgIHdoZXJlID0gd2hlcmVDbGF1c2UucXVlcnk7XG4gICAgZmluYWxQYXJhbXMgPSBmaW5hbFBhcmFtcy5jb25jYXQod2hlcmVDbGF1c2UucGFyYW1zKTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIHBhcnNlci5jYWxsYmFja19vcl90aHJvdyhlLCBjYWxsYmFjayk7XG4gICAgcmV0dXJuIHt9O1xuICB9XG5cbiAgcXVlcnkgPSB1dGlsLmZvcm1hdChxdWVyeSwgdGhpcy5fcHJvcGVydGllcy50YWJsZV9uYW1lLCB1cGRhdGVDbGF1c2VzLmpvaW4oJywgJyksIHdoZXJlKTtcblxuICBpZiAob3B0aW9ucy5jb25kaXRpb25zKSB7XG4gICAgY29uc3QgaWZDbGF1c2UgPSBwYXJzZXIuZ2V0X2lmX2NsYXVzZShzY2hlbWEsIG9wdGlvbnMuY29uZGl0aW9ucyk7XG4gICAgaWYgKGlmQ2xhdXNlLnF1ZXJ5KSB7XG4gICAgICBxdWVyeSArPSB1dGlsLmZvcm1hdCgnICVzJywgaWZDbGF1c2UucXVlcnkpO1xuICAgICAgZmluYWxQYXJhbXMgPSBmaW5hbFBhcmFtcy5jb25jYXQoaWZDbGF1c2UucGFyYW1zKTtcbiAgICB9XG4gIH0gZWxzZSBpZiAob3B0aW9ucy5pZl9leGlzdHMpIHtcbiAgICBxdWVyeSArPSAnIElGIEVYSVNUUyc7XG4gIH1cblxuICBxdWVyeSArPSAnOyc7XG5cbiAgaWYgKG9wdGlvbnMucmV0dXJuX3F1ZXJ5KSB7XG4gICAgY29uc3QgcmV0dXJuT2JqID0ge1xuICAgICAgcXVlcnksXG4gICAgICBwYXJhbXM6IGZpbmFsUGFyYW1zLFxuICAgICAgYWZ0ZXJfaG9vazogKCkgPT4ge1xuICAgICAgICBpZiAodHlwZW9mIHNjaGVtYS5hZnRlcl91cGRhdGUgPT09ICdmdW5jdGlvbicgJiYgc2NoZW1hLmFmdGVyX3VwZGF0ZShxdWVyeU9iamVjdCwgdXBkYXRlVmFsdWVzLCBvcHRpb25zKSA9PT0gZmFsc2UpIHtcbiAgICAgICAgICByZXR1cm4gYnVpbGRFcnJvcignbW9kZWwudXBkYXRlLmFmdGVyLmVycm9yJyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9LFxuICAgIH07XG4gICAgcmV0dXJuIHJldHVybk9iajtcbiAgfVxuXG4gIGNvbnN0IHF1ZXJ5T3B0aW9ucyA9IG5vcm1hbGl6ZXIubm9ybWFsaXplX3F1ZXJ5X29wdGlvbihvcHRpb25zKTtcblxuICB0aGlzLl9leGVjdXRlX3RhYmxlX3F1ZXJ5KHF1ZXJ5LCBmaW5hbFBhcmFtcywgcXVlcnlPcHRpb25zLCAoZXJyLCByZXN1bHRzKSA9PiB7XG4gICAgaWYgKHR5cGVvZiBjYWxsYmFjayA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgaWYgKGVycikge1xuICAgICAgICBjYWxsYmFjayhidWlsZEVycm9yKCdtb2RlbC51cGRhdGUuZGJlcnJvcicsIGVycikpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBpZiAodHlwZW9mIHNjaGVtYS5hZnRlcl91cGRhdGUgPT09ICdmdW5jdGlvbicgJiYgc2NoZW1hLmFmdGVyX3VwZGF0ZShxdWVyeU9iamVjdCwgdXBkYXRlVmFsdWVzLCBvcHRpb25zKSA9PT0gZmFsc2UpIHtcbiAgICAgICAgY2FsbGJhY2soYnVpbGRFcnJvcignbW9kZWwudXBkYXRlLmFmdGVyLmVycm9yJykpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBjYWxsYmFjayhudWxsLCByZXN1bHRzKTtcbiAgICB9IGVsc2UgaWYgKGVycikge1xuICAgICAgdGhyb3cgKGJ1aWxkRXJyb3IoJ21vZGVsLnVwZGF0ZS5kYmVycm9yJywgZXJyKSk7XG4gICAgfSBlbHNlIGlmICh0eXBlb2Ygc2NoZW1hLmFmdGVyX3VwZGF0ZSA9PT0gJ2Z1bmN0aW9uJyAmJiBzY2hlbWEuYWZ0ZXJfdXBkYXRlKHF1ZXJ5T2JqZWN0LCB1cGRhdGVWYWx1ZXMsIG9wdGlvbnMpID09PSBmYWxzZSkge1xuICAgICAgdGhyb3cgKGJ1aWxkRXJyb3IoJ21vZGVsLnVwZGF0ZS5hZnRlci5lcnJvcicpKTtcbiAgICB9XG4gIH0pO1xuXG4gIHJldHVybiB7fTtcbn07XG5cbkJhc2VNb2RlbC5kZWxldGUgPSBmdW5jdGlvbiBmKHF1ZXJ5T2JqZWN0LCBvcHRpb25zLCBjYWxsYmFjaykge1xuICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMiAmJiB0eXBlb2Ygb3B0aW9ucyA9PT0gJ2Z1bmN0aW9uJykge1xuICAgIGNhbGxiYWNrID0gb3B0aW9ucztcbiAgICBvcHRpb25zID0ge307XG4gIH1cblxuICBjb25zdCBzY2hlbWEgPSB0aGlzLl9wcm9wZXJ0aWVzLnNjaGVtYTtcblxuICBjb25zdCBkZWZhdWx0cyA9IHtcbiAgICBwcmVwYXJlOiB0cnVlLFxuICB9O1xuXG4gIG9wdGlvbnMgPSBfLmRlZmF1bHRzRGVlcChvcHRpb25zLCBkZWZhdWx0cyk7XG5cbiAgaWYgKHR5cGVvZiBzY2hlbWEuYmVmb3JlX2RlbGV0ZSA9PT0gJ2Z1bmN0aW9uJyAmJiBzY2hlbWEuYmVmb3JlX2RlbGV0ZShxdWVyeU9iamVjdCwgb3B0aW9ucykgPT09IGZhbHNlKSB7XG4gICAgcGFyc2VyLmNhbGxiYWNrX29yX3Rocm93KGJ1aWxkRXJyb3IoJ21vZGVsLmRlbGV0ZS5iZWZvcmUuZXJyb3InKSwgY2FsbGJhY2spO1xuICAgIHJldHVybiB7fTtcbiAgfVxuXG4gIGxldCBxdWVyeVBhcmFtcyA9IFtdO1xuXG4gIGxldCBxdWVyeSA9ICdERUxFVEUgRlJPTSBcIiVzXCIgJXM7JztcbiAgbGV0IHdoZXJlID0gJyc7XG4gIHRyeSB7XG4gICAgY29uc3Qgd2hlcmVDbGF1c2UgPSBwYXJzZXIuZ2V0X3doZXJlX2NsYXVzZShzY2hlbWEsIHF1ZXJ5T2JqZWN0KTtcbiAgICB3aGVyZSA9IHdoZXJlQ2xhdXNlLnF1ZXJ5O1xuICAgIHF1ZXJ5UGFyYW1zID0gcXVlcnlQYXJhbXMuY29uY2F0KHdoZXJlQ2xhdXNlLnBhcmFtcyk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBwYXJzZXIuY2FsbGJhY2tfb3JfdGhyb3coZSwgY2FsbGJhY2spO1xuICAgIHJldHVybiB7fTtcbiAgfVxuXG4gIHF1ZXJ5ID0gdXRpbC5mb3JtYXQocXVlcnksIHRoaXMuX3Byb3BlcnRpZXMudGFibGVfbmFtZSwgd2hlcmUpO1xuXG4gIGlmIChvcHRpb25zLnJldHVybl9xdWVyeSkge1xuICAgIGNvbnN0IHJldHVybk9iaiA9IHtcbiAgICAgIHF1ZXJ5LFxuICAgICAgcGFyYW1zOiBxdWVyeVBhcmFtcyxcbiAgICAgIGFmdGVyX2hvb2s6ICgpID0+IHtcbiAgICAgICAgaWYgKHR5cGVvZiBzY2hlbWEuYWZ0ZXJfZGVsZXRlID09PSAnZnVuY3Rpb24nICYmIHNjaGVtYS5hZnRlcl9kZWxldGUocXVlcnlPYmplY3QsIG9wdGlvbnMpID09PSBmYWxzZSkge1xuICAgICAgICAgIHJldHVybiBidWlsZEVycm9yKCdtb2RlbC5kZWxldGUuYWZ0ZXIuZXJyb3InKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH0sXG4gICAgfTtcbiAgICByZXR1cm4gcmV0dXJuT2JqO1xuICB9XG5cbiAgY29uc3QgcXVlcnlPcHRpb25zID0gbm9ybWFsaXplci5ub3JtYWxpemVfcXVlcnlfb3B0aW9uKG9wdGlvbnMpO1xuXG4gIHRoaXMuX2V4ZWN1dGVfdGFibGVfcXVlcnkocXVlcnksIHF1ZXJ5UGFyYW1zLCBxdWVyeU9wdGlvbnMsIChlcnIsIHJlc3VsdHMpID0+IHtcbiAgICBpZiAodHlwZW9mIGNhbGxiYWNrID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICBpZiAoZXJyKSB7XG4gICAgICAgIGNhbGxiYWNrKGJ1aWxkRXJyb3IoJ21vZGVsLmRlbGV0ZS5kYmVycm9yJywgZXJyKSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGlmICh0eXBlb2Ygc2NoZW1hLmFmdGVyX2RlbGV0ZSA9PT0gJ2Z1bmN0aW9uJyAmJiBzY2hlbWEuYWZ0ZXJfZGVsZXRlKHF1ZXJ5T2JqZWN0LCBvcHRpb25zKSA9PT0gZmFsc2UpIHtcbiAgICAgICAgY2FsbGJhY2soYnVpbGRFcnJvcignbW9kZWwuZGVsZXRlLmFmdGVyLmVycm9yJykpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBjYWxsYmFjayhudWxsLCByZXN1bHRzKTtcbiAgICB9IGVsc2UgaWYgKGVycikge1xuICAgICAgdGhyb3cgKGJ1aWxkRXJyb3IoJ21vZGVsLmRlbGV0ZS5kYmVycm9yJywgZXJyKSk7XG4gICAgfSBlbHNlIGlmICh0eXBlb2Ygc2NoZW1hLmFmdGVyX2RlbGV0ZSA9PT0gJ2Z1bmN0aW9uJyAmJiBzY2hlbWEuYWZ0ZXJfZGVsZXRlKHF1ZXJ5T2JqZWN0LCBvcHRpb25zKSA9PT0gZmFsc2UpIHtcbiAgICAgIHRocm93IChidWlsZEVycm9yKCdtb2RlbC5kZWxldGUuYWZ0ZXIuZXJyb3InKSk7XG4gICAgfVxuICB9KTtcblxuICByZXR1cm4ge307XG59O1xuXG5CYXNlTW9kZWwudHJ1bmNhdGUgPSBmdW5jdGlvbiBmKGNhbGxiYWNrKSB7XG4gIGNvbnN0IHByb3BlcnRpZXMgPSB0aGlzLl9wcm9wZXJ0aWVzO1xuICBjb25zdCB0YWJsZU5hbWUgPSBwcm9wZXJ0aWVzLnRhYmxlX25hbWU7XG5cbiAgY29uc3QgcXVlcnkgPSB1dGlsLmZvcm1hdCgnVFJVTkNBVEUgVEFCTEUgXCIlc1wiOycsIHRhYmxlTmFtZSk7XG4gIHRoaXMuX2V4ZWN1dGVfdGFibGVfcXVlcnkocXVlcnksIFtdLCBjYWxsYmFjayk7XG59O1xuXG5CYXNlTW9kZWwucHJvdG90eXBlLmdldF9kYXRhX3R5cGVzID0gZnVuY3Rpb24gZigpIHtcbiAgcmV0dXJuIGNxbC50eXBlcztcbn07XG5cbkJhc2VNb2RlbC5wcm90b3R5cGUuZ2V0X3RhYmxlX25hbWUgPSBmdW5jdGlvbiBmKCkge1xuICByZXR1cm4gdGhpcy5jb25zdHJ1Y3Rvci5nZXRfdGFibGVfbmFtZSgpO1xufTtcblxuQmFzZU1vZGVsLnByb3RvdHlwZS5nZXRfa2V5c3BhY2VfbmFtZSA9IGZ1bmN0aW9uIGYoKSB7XG4gIHJldHVybiB0aGlzLmNvbnN0cnVjdG9yLmdldF9rZXlzcGFjZV9uYW1lKCk7XG59O1xuXG5CYXNlTW9kZWwucHJvdG90eXBlLl9nZXRfZGVmYXVsdF92YWx1ZSA9IGZ1bmN0aW9uIGYoZmllbGRuYW1lKSB7XG4gIGNvbnN0IHByb3BlcnRpZXMgPSB0aGlzLmNvbnN0cnVjdG9yLl9wcm9wZXJ0aWVzO1xuICBjb25zdCBzY2hlbWEgPSBwcm9wZXJ0aWVzLnNjaGVtYTtcblxuICBpZiAoXy5pc1BsYWluT2JqZWN0KHNjaGVtYS5maWVsZHNbZmllbGRuYW1lXSkgJiYgc2NoZW1hLmZpZWxkc1tmaWVsZG5hbWVdLmRlZmF1bHQgIT09IHVuZGVmaW5lZCkge1xuICAgIGlmICh0eXBlb2Ygc2NoZW1hLmZpZWxkc1tmaWVsZG5hbWVdLmRlZmF1bHQgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgIHJldHVybiBzY2hlbWEuZmllbGRzW2ZpZWxkbmFtZV0uZGVmYXVsdC5jYWxsKHRoaXMpO1xuICAgIH1cbiAgICByZXR1cm4gc2NoZW1hLmZpZWxkc1tmaWVsZG5hbWVdLmRlZmF1bHQ7XG4gIH1cbiAgcmV0dXJuIHVuZGVmaW5lZDtcbn07XG5cbkJhc2VNb2RlbC5wcm90b3R5cGUudmFsaWRhdGUgPSBmdW5jdGlvbiBmKHByb3BlcnR5TmFtZSwgdmFsdWUpIHtcbiAgdmFsdWUgPSB2YWx1ZSB8fCB0aGlzW3Byb3BlcnR5TmFtZV07XG4gIHRoaXMuX3ZhbGlkYXRvcnMgPSB0aGlzLl92YWxpZGF0b3JzIHx8IHt9O1xuICByZXR1cm4gc2NoZW1lci5nZXRfdmFsaWRhdGlvbl9tZXNzYWdlKHRoaXMuX3ZhbGlkYXRvcnNbcHJvcGVydHlOYW1lXSB8fCBbXSwgdmFsdWUpO1xufTtcblxuQmFzZU1vZGVsLnByb3RvdHlwZS5zYXZlID0gZnVuY3Rpb24gZm4ob3B0aW9ucywgY2FsbGJhY2spIHtcbiAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDEgJiYgdHlwZW9mIG9wdGlvbnMgPT09ICdmdW5jdGlvbicpIHtcbiAgICBjYWxsYmFjayA9IG9wdGlvbnM7XG4gICAgb3B0aW9ucyA9IHt9O1xuICB9XG5cbiAgY29uc3QgcHJvcGVydGllcyA9IHRoaXMuY29uc3RydWN0b3IuX3Byb3BlcnRpZXM7XG4gIGNvbnN0IHNjaGVtYSA9IHByb3BlcnRpZXMuc2NoZW1hO1xuXG4gIGNvbnN0IGRlZmF1bHRzID0ge1xuICAgIHByZXBhcmU6IHRydWUsXG4gIH07XG5cbiAgb3B0aW9ucyA9IF8uZGVmYXVsdHNEZWVwKG9wdGlvbnMsIGRlZmF1bHRzKTtcblxuICBpZiAodHlwZW9mIHNjaGVtYS5iZWZvcmVfc2F2ZSA9PT0gJ2Z1bmN0aW9uJyAmJiBzY2hlbWEuYmVmb3JlX3NhdmUodGhpcywgb3B0aW9ucykgPT09IGZhbHNlKSB7XG4gICAgcGFyc2VyLmNhbGxiYWNrX29yX3Rocm93KGJ1aWxkRXJyb3IoJ21vZGVsLnNhdmUuYmVmb3JlLmVycm9yJyksIGNhbGxiYWNrKTtcbiAgICByZXR1cm4ge307XG4gIH1cblxuICBjb25zdCB7XG4gICAgaWRlbnRpZmllcnMsXG4gICAgdmFsdWVzLFxuICAgIHF1ZXJ5UGFyYW1zLFxuICAgIGVycm9ySGFwcGVuZWQsXG4gIH0gPSBwYXJzZXIuZ2V0X3NhdmVfdmFsdWVfZXhwcmVzc2lvbih0aGlzLCBzY2hlbWEsIGNhbGxiYWNrKTtcblxuICBpZiAoZXJyb3JIYXBwZW5lZCkgcmV0dXJuIHt9O1xuXG4gIGxldCBxdWVyeSA9IHV0aWwuZm9ybWF0KFxuICAgICdJTlNFUlQgSU5UTyBcIiVzXCIgKCAlcyApIFZBTFVFUyAoICVzICknLFxuICAgIHByb3BlcnRpZXMudGFibGVfbmFtZSxcbiAgICBpZGVudGlmaWVycy5qb2luKCcgLCAnKSxcbiAgICB2YWx1ZXMuam9pbignICwgJyksXG4gICk7XG5cbiAgaWYgKG9wdGlvbnMuaWZfbm90X2V4aXN0KSBxdWVyeSArPSAnIElGIE5PVCBFWElTVFMnO1xuICBpZiAob3B0aW9ucy50dGwpIHF1ZXJ5ICs9IHV0aWwuZm9ybWF0KCcgVVNJTkcgVFRMICVzJywgb3B0aW9ucy50dGwpO1xuXG4gIHF1ZXJ5ICs9ICc7JztcblxuICBpZiAob3B0aW9ucy5yZXR1cm5fcXVlcnkpIHtcbiAgICBjb25zdCByZXR1cm5PYmogPSB7XG4gICAgICBxdWVyeSxcbiAgICAgIHBhcmFtczogcXVlcnlQYXJhbXMsXG4gICAgICBhZnRlcl9ob29rOiAoKSA9PiB7XG4gICAgICAgIGlmICh0eXBlb2Ygc2NoZW1hLmFmdGVyX3NhdmUgPT09ICdmdW5jdGlvbicgJiYgc2NoZW1hLmFmdGVyX3NhdmUodGhpcywgb3B0aW9ucykgPT09IGZhbHNlKSB7XG4gICAgICAgICAgcmV0dXJuIGJ1aWxkRXJyb3IoJ21vZGVsLnNhdmUuYWZ0ZXIuZXJyb3InKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH0sXG4gICAgfTtcbiAgICByZXR1cm4gcmV0dXJuT2JqO1xuICB9XG5cbiAgY29uc3QgcXVlcnlPcHRpb25zID0gbm9ybWFsaXplci5ub3JtYWxpemVfcXVlcnlfb3B0aW9uKG9wdGlvbnMpO1xuXG4gIHRoaXMuY29uc3RydWN0b3IuX2V4ZWN1dGVfdGFibGVfcXVlcnkocXVlcnksIHF1ZXJ5UGFyYW1zLCBxdWVyeU9wdGlvbnMsIChlcnIsIHJlc3VsdCkgPT4ge1xuICAgIGlmICh0eXBlb2YgY2FsbGJhY2sgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgY2FsbGJhY2soYnVpbGRFcnJvcignbW9kZWwuc2F2ZS5kYmVycm9yJywgZXJyKSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGlmICghb3B0aW9ucy5pZl9ub3RfZXhpc3QgfHwgKHJlc3VsdC5yb3dzICYmIHJlc3VsdC5yb3dzWzBdICYmIHJlc3VsdC5yb3dzWzBdWydbYXBwbGllZF0nXSkpIHtcbiAgICAgICAgdGhpcy5fbW9kaWZpZWQgPSB7fTtcbiAgICAgIH1cbiAgICAgIGlmICh0eXBlb2Ygc2NoZW1hLmFmdGVyX3NhdmUgPT09ICdmdW5jdGlvbicgJiYgc2NoZW1hLmFmdGVyX3NhdmUodGhpcywgb3B0aW9ucykgPT09IGZhbHNlKSB7XG4gICAgICAgIGNhbGxiYWNrKGJ1aWxkRXJyb3IoJ21vZGVsLnNhdmUuYWZ0ZXIuZXJyb3InKSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3VsdCk7XG4gICAgfSBlbHNlIGlmIChlcnIpIHtcbiAgICAgIHRocm93IChidWlsZEVycm9yKCdtb2RlbC5zYXZlLmRiZXJyb3InLCBlcnIpKTtcbiAgICB9IGVsc2UgaWYgKHR5cGVvZiBzY2hlbWEuYWZ0ZXJfc2F2ZSA9PT0gJ2Z1bmN0aW9uJyAmJiBzY2hlbWEuYWZ0ZXJfc2F2ZSh0aGlzLCBvcHRpb25zKSA9PT0gZmFsc2UpIHtcbiAgICAgIHRocm93IChidWlsZEVycm9yKCdtb2RlbC5zYXZlLmFmdGVyLmVycm9yJykpO1xuICAgIH1cbiAgfSk7XG5cbiAgcmV0dXJuIHt9O1xufTtcblxuQmFzZU1vZGVsLnByb3RvdHlwZS5kZWxldGUgPSBmdW5jdGlvbiBmKG9wdGlvbnMsIGNhbGxiYWNrKSB7XG4gIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAxICYmIHR5cGVvZiBvcHRpb25zID09PSAnZnVuY3Rpb24nKSB7XG4gICAgY2FsbGJhY2sgPSBvcHRpb25zO1xuICAgIG9wdGlvbnMgPSB7fTtcbiAgfVxuXG4gIGNvbnN0IHNjaGVtYSA9IHRoaXMuY29uc3RydWN0b3IuX3Byb3BlcnRpZXMuc2NoZW1hO1xuICBjb25zdCBkZWxldGVRdWVyeSA9IHt9O1xuXG4gIGZvciAobGV0IGkgPSAwOyBpIDwgc2NoZW1hLmtleS5sZW5ndGg7IGkrKykge1xuICAgIGNvbnN0IGZpZWxkS2V5ID0gc2NoZW1hLmtleVtpXTtcbiAgICBpZiAoXy5pc0FycmF5KGZpZWxkS2V5KSkge1xuICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBmaWVsZEtleS5sZW5ndGg7IGorKykge1xuICAgICAgICBkZWxldGVRdWVyeVtmaWVsZEtleVtqXV0gPSB0aGlzW2ZpZWxkS2V5W2pdXTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgZGVsZXRlUXVlcnlbZmllbGRLZXldID0gdGhpc1tmaWVsZEtleV07XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHRoaXMuY29uc3RydWN0b3IuZGVsZXRlKGRlbGV0ZVF1ZXJ5LCBvcHRpb25zLCBjYWxsYmFjayk7XG59O1xuXG5CYXNlTW9kZWwucHJvdG90eXBlLnRvSlNPTiA9IGZ1bmN0aW9uIHRvSlNPTigpIHtcbiAgY29uc3Qgb2JqZWN0ID0ge307XG4gIGNvbnN0IHNjaGVtYSA9IHRoaXMuY29uc3RydWN0b3IuX3Byb3BlcnRpZXMuc2NoZW1hO1xuXG4gIE9iamVjdC5rZXlzKHNjaGVtYS5maWVsZHMpLmZvckVhY2goKGZpZWxkKSA9PiB7XG4gICAgb2JqZWN0W2ZpZWxkXSA9IHRoaXNbZmllbGRdO1xuICB9KTtcblxuICByZXR1cm4gb2JqZWN0O1xufTtcblxuQmFzZU1vZGVsLnByb3RvdHlwZS5pc01vZGlmaWVkID0gZnVuY3Rpb24gaXNNb2RpZmllZChwcm9wTmFtZSkge1xuICBpZiAocHJvcE5hbWUpIHtcbiAgICByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHRoaXMuX21vZGlmaWVkLCBwcm9wTmFtZSk7XG4gIH1cbiAgcmV0dXJuIE9iamVjdC5rZXlzKHRoaXMuX21vZGlmaWVkKS5sZW5ndGggIT09IDA7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IEJhc2VNb2RlbDtcbiJdfQ==